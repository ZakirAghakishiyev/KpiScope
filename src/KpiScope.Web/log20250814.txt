2025-08-14 10:39:26.648 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 10:39:26.696 +04:00 [INF] Registered 32 endpoints in 7,343 milliseconds.
2025-08-14 10:39:29.739 +04:00 [INF] Executed DbCommand (39ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:39:29.921 +04:00 [INF] Executed DbCommand (159ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:39:29.956 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:39:29.964 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:39:30.038 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 10:39:30.061 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 10:39:30.459 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 10:39:30.463 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 10:39:30.466 +04:00 [INF] Hosting environment: Development
2025-08-14 10:39:30.467 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 10:39:33.117 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/ - null null
2025-08-14 10:39:35.292 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/   Responded with [404] in 137ms
2025-08-14 10:39:35.301 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/ - 404 157 application/json 2185.2973ms
2025-08-14 10:39:35.322 +04:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:57679/, Response status code: 404
2025-08-14 10:39:35.974 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/favicon.ico - null null
2025-08-14 10:39:35.987 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/favicon.ico   Responded with [404] in 1ms
2025-08-14 10:39:35.989 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/favicon.ico - 404 157 application/json 14.1292ms
2025-08-14 10:39:35.993 +04:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:57679/favicon.ico, Response status code: 404
2025-08-14 10:39:38.999 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/swagger/index.html - null null
2025-08-14 10:39:39.046 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/swagger/index.html - 200 null text/html; charset=utf-8 47.4464ms
2025-08-14 10:39:39.989 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/swagger/v1/swagger.json - null null
2025-08-14 10:39:41.337 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/swagger/v1/swagger.json - 200 null application/json; charset=utf-8 1348.3547ms
2025-08-14 10:39:58.054 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations - application/json 116
2025-08-14 10:39:58.070 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:39:58.956 +04:00 [ERR] Failed executing DbCommand (154ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmations] ([CompletedAt], [CreatedAt], [CurrentStepNumber], [KpiGroupCompanyId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 10:39:59.009 +04:00 [ERR] An exception occurred in the database while saving changes for context type 'KpiScope.Infrastructure.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'CompletedAt'.
Invalid column name 'CreatedAt'.
Invalid column name 'CurrentStepNumber'.
Invalid column name 'Status'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:2e93d6b9-de4e-4eda-9632-6137434ffd6d
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'CompletedAt'.
Invalid column name 'CreatedAt'.
Invalid column name 'CurrentStepNumber'.
Invalid column name 'Status'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:2e93d6b9-de4e-4eda-9632-6137434ffd6d
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-14 10:39:59.046 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:39:59.052 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'CompletedAt'.
Invalid column name 'CreatedAt'.
Invalid column name 'CurrentStepNumber'.
Invalid column name 'Status'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:2e93d6b9-de4e-4eda-9632-6137434ffd6d
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.SaveChangesAsync(CancellationToken cancellationToken)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.AddAsync(T entity, CancellationToken cancellationToken)
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.StartConfirmationAsync(StartKpiConfirmationRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 31
   at KpiScope.Web.KpiConfirmation.StartConfirmation.StartKpiConfirmation.HandleAsync(StartKpiConfirmationRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\StartConfirmation\StartKpiConfirmation.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:39:59.097 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations  {
  "kpiGroupCompanyId": 1,
  "periodStart": "2025-08-14T06:39:51.487Z",
  "periodEnd": "2025-08-14T06:39:51.487Z"
} Responded with [500] in 1032ms
2025-08-14 10:39:59.106 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations - 500 165 application/json 1051.813ms
2025-08-14 10:40:06.525 +04:00 [INF] Application is shutting down...
2025-08-14 10:40:24.417 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 10:40:24.476 +04:00 [INF] Registered 32 endpoints in 808 milliseconds.
2025-08-14 10:40:25.810 +04:00 [INF] Executed DbCommand (35ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:40:25.904 +04:00 [INF] Executed DbCommand (69ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:40:25.938 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:40:26.067 +04:00 [INF] Executed DbCommand (70ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [KPI] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-08-14 10:40:26.278 +04:00 [INF] Executed DbCommand (204ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [KPI];
2025-08-14 10:40:26.666 +04:00 [INF] Executed DbCommand (265ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [KPI];
2025-08-14 10:40:26.767 +04:00 [INF] Executed DbCommand (92ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [KPI] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-08-14 10:40:26.781 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:40:26.953 +04:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Companies] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [Address] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Companies] PRIMARY KEY ([Id])
);
2025-08-14 10:40:26.965 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [DynamicValues] (
    [Id] int NOT NULL IDENTITY,
    [Types] nvarchar(max) NOT NULL,
    [JsonValue] nvarchar(max) NOT NULL,
    [Name] nvarchar(max) NULL,
    CONSTRAINT [PK_DynamicValues] PRIMARY KEY ([Id])
);
2025-08-14 10:40:26.977 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiGroups] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_KpiGroups] PRIMARY KEY ([Id])
);
2025-08-14 10:40:26.991 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [Id] int NOT NULL IDENTITY,
    [Username] nvarchar(max) NOT NULL,
    [Email] nvarchar(max) NOT NULL,
    [PasswordHash] nvarchar(max) NOT NULL,
    [CompanyId] int NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Users_Companies_CompanyId] FOREIGN KEY ([CompanyId]) REFERENCES [Companies] ([Id]) ON DELETE CASCADE
);
2025-08-14 10:40:27.003 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Kpis] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [GriIndex] int NOT NULL,
    [TimePeriod] int NOT NULL,
    [KpiGroupId] int NOT NULL,
    [CompanyId] int NULL,
    CONSTRAINT [PK_Kpis] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Kpis_Companies_CompanyId] FOREIGN KEY ([CompanyId]) REFERENCES [Companies] ([Id]),
    CONSTRAINT [FK_Kpis_KpiGroups_KpiGroupId] FOREIGN KEY ([KpiGroupId]) REFERENCES [KpiGroups] ([Id]) ON DELETE CASCADE
);
2025-08-14 10:40:27.013 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiGroupCompanys] (
    [Id] int NOT NULL IDENTITY,
    [KpiGroupId] int NOT NULL,
    [CompanyId] int NOT NULL,
    [UserId] int NOT NULL,
    CONSTRAINT [PK_KpiGroupCompanys] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiGroupCompanys_Companies_CompanyId] FOREIGN KEY ([CompanyId]) REFERENCES [Companies] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_KpiGroupCompanys_KpiGroups_KpiGroupId] FOREIGN KEY ([KpiGroupId]) REFERENCES [KpiGroups] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_KpiGroupCompanys_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE NO ACTION
);
2025-08-14 10:40:27.021 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiConfirmations] (
    [Id] int NOT NULL IDENTITY,
    [KpiGroupCompanyId] int NOT NULL,
    [Status] int NOT NULL,
    [CurrentStepNumber] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [CompletedAt] datetime2 NULL,
    CONSTRAINT [PK_KpiConfirmations] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiConfirmations_KpiGroupCompanys_KpiGroupCompanyId] FOREIGN KEY ([KpiGroupCompanyId]) REFERENCES [KpiGroupCompanys] ([Id]) ON DELETE CASCADE
);
2025-08-14 10:40:27.035 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiConfirmationStep] (
    [Id] int NOT NULL IDENTITY,
    [KpiConfirmationId] int NOT NULL,
    [StepNumber] int NOT NULL,
    [Status] int NOT NULL,
    [StartedAt] datetime2 NULL,
    [CompletedAt] datetime2 NULL,
    CONSTRAINT [PK_KpiConfirmationStep] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiConfirmationStep_KpiConfirmations_KpiConfirmationId] FOREIGN KEY ([KpiConfirmationId]) REFERENCES [KpiConfirmations] ([Id]) ON DELETE CASCADE
);
2025-08-14 10:40:27.046 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiValues] (
    [Id] int NOT NULL IDENTITY,
    [KpiId] int NOT NULL,
    [ValueId] int NOT NULL,
    [Status] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [Comment] nvarchar(max) NOT NULL,
    [KpiConfirmationId] int NULL,
    CONSTRAINT [PK_KpiValues] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiValues_DynamicValues_ValueId] FOREIGN KEY ([ValueId]) REFERENCES [DynamicValues] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_KpiValues_KpiConfirmations_KpiConfirmationId] FOREIGN KEY ([KpiConfirmationId]) REFERENCES [KpiConfirmations] ([Id]),
    CONSTRAINT [FK_KpiValues_Kpis_KpiId] FOREIGN KEY ([KpiId]) REFERENCES [Kpis] ([Id]) ON DELETE CASCADE
);
2025-08-14 10:40:27.055 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiConfirmationUsers] (
    [Id] int NOT NULL IDENTITY,
    [KpiConfirmationStepId] int NOT NULL,
    [UserId] int NOT NULL,
    [IsConfirmed] bit NULL,
    [Comment] nvarchar(max) NOT NULL,
    [ActionDate] datetime2 NULL,
    CONSTRAINT [PK_KpiConfirmationUsers] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiConfirmationUsers_KpiConfirmationStep_KpiConfirmationStepId] FOREIGN KEY ([KpiConfirmationStepId]) REFERENCES [KpiConfirmationStep] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_KpiConfirmationUsers_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE NO ACTION
);
2025-08-14 10:40:27.068 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmations_KpiGroupCompanyId] ON [KpiConfirmations] ([KpiGroupCompanyId]);
2025-08-14 10:40:27.077 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmationStep_KpiConfirmationId] ON [KpiConfirmationStep] ([KpiConfirmationId]);
2025-08-14 10:40:27.086 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmationUsers_KpiConfirmationStepId] ON [KpiConfirmationUsers] ([KpiConfirmationStepId]);
2025-08-14 10:40:27.093 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmationUsers_UserId] ON [KpiConfirmationUsers] ([UserId]);
2025-08-14 10:40:27.101 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiGroupCompanys_CompanyId] ON [KpiGroupCompanys] ([CompanyId]);
2025-08-14 10:40:27.116 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiGroupCompanys_KpiGroupId] ON [KpiGroupCompanys] ([KpiGroupId]);
2025-08-14 10:40:27.124 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiGroupCompanys_UserId] ON [KpiGroupCompanys] ([UserId]);
2025-08-14 10:40:27.133 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Kpis_CompanyId] ON [Kpis] ([CompanyId]);
2025-08-14 10:40:27.140 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Kpis_KpiGroupId] ON [Kpis] ([KpiGroupId]);
2025-08-14 10:40:27.146 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiValues_KpiConfirmationId] ON [KpiValues] ([KpiConfirmationId]);
2025-08-14 10:40:27.151 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiValues_KpiId] ON [KpiValues] ([KpiId]);
2025-08-14 10:40:27.161 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiValues_ValueId] ON [KpiValues] ([ValueId]);
2025-08-14 10:40:27.168 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Users_CompanyId] ON [Users] ([CompanyId]);
2025-08-14 10:40:27.246 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 10:40:27.271 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 10:40:27.695 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 10:40:27.697 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 10:40:27.698 +04:00 [INF] Hosting environment: Development
2025-08-14 10:40:27.700 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 10:40:40.000 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/swagger/index.html - null null
2025-08-14 10:40:40.265 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/swagger/index.html - 200 null text/html; charset=utf-8 266.6663ms
2025-08-14 10:40:40.769 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/swagger/v1/swagger.json - null null
2025-08-14 10:40:41.723 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/swagger/v1/swagger.json - 200 null application/json; charset=utf-8 954.2295ms
2025-08-14 10:40:53.800 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/auth/Register - application/json 100
2025-08-14 10:40:53.827 +04:00 [INF] Executing endpoint 'HTTP: POST auth/Register'
2025-08-14 10:40:54.841 +04:00 [INF] Executed DbCommand (70ms) [Parameters=[@__mail_0='?' (Size = 4000), @__username_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Email] = @__mail_0 OR [u].[Username] = @__username_1
2025-08-14 10:40:55.168 +04:00 [INF] Executed DbCommand (37ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CompanyId], [Email], [PasswordHash], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2025-08-14 10:40:55.219 +04:00 [ERR] An exception occurred in the database while saving changes for context type 'KpiScope.Infrastructure.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Users_Companies_CompanyId". The conflict occurred in database "KPI", table "dbo.Companies", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:eb1ea099-c105-4dde-baee-5106dc641324
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Users_Companies_CompanyId". The conflict occurred in database "KPI", table "dbo.Companies", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:eb1ea099-c105-4dde-baee-5106dc641324
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-14 10:40:55.251 +04:00 [ERR] Exception Occured
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Users_Companies_CompanyId". The conflict occurred in database "KPI", table "dbo.Companies", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:eb1ea099-c105-4dde-baee-5106dc641324
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.SaveChangesAsync(CancellationToken cancellationToken)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.AddAsync(T entity, CancellationToken cancellationToken)
   at KpiScope.Web.Register.RegisterEndpointService.RegisterAsync(RegisterRequest req, CancellationToken ct) in E:\Work\KPI\KpiScope\src\KpiScope.Web\Register\RegisterEndpointService.cs:line 27
2025-08-14 10:40:55.299 +04:00 [ERR] Exception
System.InvalidOperationException: An error occurred while saving the entity changes. See the inner exception for details.
   at KpiScope.Web.Register.ResgisterEndpoint.HandleAsync(RegisterRequest req, CancellationToken ct) in E:\Work\KPI\KpiScope\src\KpiScope.Web\Register\RegisterEndpoint.cs:line 23
2025-08-14 10:40:55.346 +04:00 [INF] Executed endpoint 'HTTP: POST auth/Register'
2025-08-14 10:40:55.407 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/auth/Register  {
  "username": "string",
  "password": "string",
  "email": "user@example.com",
  "comapanyId": 0
} Responded with [400] in 1577ms
2025-08-14 10:40:55.414 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/auth/Register - 400 217 application/json 1614.4887ms
2025-08-14 10:41:08.323 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Companies - application/json 45
2025-08-14 10:41:08.330 +04:00 [INF] Executing endpoint 'HTTP: POST /Companies'
2025-08-14 10:41:08.399 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Companies] ([Address], [Name])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1);
2025-08-14 10:41:08.446 +04:00 [INF] Executed endpoint 'HTTP: POST /Companies'
2025-08-14 10:41:08.489 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Companies  {
  "name": "string",
  "address": "string"
} Responded with [200] in 158ms
2025-08-14 10:41:08.494 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Companies - 200 150 application/json 170.7346ms
2025-08-14 10:41:21.524 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/auth/Register - application/json 100
2025-08-14 10:41:21.564 +04:00 [INF] Executing endpoint 'HTTP: POST auth/Register'
2025-08-14 10:41:21.580 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[@__mail_0='?' (Size = 4000), @__username_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Email] = @__mail_0 OR [u].[Username] = @__username_1
2025-08-14 10:41:21.589 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CompanyId], [Email], [PasswordHash], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2025-08-14 10:41:21.628 +04:00 [INF] Executed DbCommand (22ms) [Parameters=[@p4='?' (DbType = Int32), @p0='?' (DbType = Int32), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Users] SET [CompanyId] = @p0, [Email] = @p1, [PasswordHash] = @p2, [Username] = @p3
OUTPUT 1
WHERE [Id] = @p4;
2025-08-14 10:41:21.642 +04:00 [INF] Executed endpoint 'HTTP: POST auth/Register'
2025-08-14 10:41:21.646 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/auth/Register  {
  "username": "string",
  "password": "string",
  "email": "user@example.com",
  "comapanyId": 1
} Responded with [200] in 82ms
2025-08-14 10:41:21.650 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/auth/Register - 200 162 application/json 125.9671ms
2025-08-14 10:41:38.867 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/KpiGroups - application/json 30
2025-08-14 10:41:38.873 +04:00 [INF] Executing endpoint 'HTTP: POST /KpiGroups'
2025-08-14 10:41:38.917 +04:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiGroups] ([Name])
OUTPUT INSERTED.[Id]
VALUES (@p0);
2025-08-14 10:41:38.932 +04:00 [INF] Executed endpoint 'HTTP: POST /KpiGroups'
2025-08-14 10:41:38.936 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/KpiGroups  {
  "name": "KPI Group Name"
} Responded with [200] in 63ms
2025-08-14 10:41:38.939 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/KpiGroups - 200 132 application/json 71.8732ms
2025-08-14 10:41:51.658 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/KpiGroupCompanies - application/json 54
2025-08-14 10:41:51.664 +04:00 [INF] Executing endpoint 'HTTP: POST /KpiGroupCompanies'
2025-08-14 10:41:51.710 +04:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiGroupCompanys] ([CompanyId], [KpiGroupId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 10:41:51.727 +04:00 [INF] Executed endpoint 'HTTP: POST /KpiGroupCompanies'
2025-08-14 10:41:51.732 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/KpiGroupCompanies  {
  "kpiGroupId": 1,
  "companyId": 1,
  "userId": 2
} Responded with [200] in 68ms
2025-08-14 10:41:51.736 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/KpiGroupCompanies - 200 162 application/json 77.4003ms
2025-08-14 10:42:12.620 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi - application/json 77
2025-08-14 10:42:12.629 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi'
2025-08-14 10:42:12.732 +04:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Kpis] ([CompanyId], [GriIndex], [KpiGroupId], [Name], [TimePeriod])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 10:42:12.752 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi'
2025-08-14 10:42:12.756 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi  {
  "name": "string",
  "griIndex": 1,
  "timePeriod": 1,
  "kpiGroupId": 1
} Responded with [200] in 126ms
2025-08-14 10:42:12.761 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi - 200 188 application/json 141.1105ms
2025-08-14 10:42:29.522 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi/AddValue - application/json 277
2025-08-14 10:42:29.530 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 10:42:29.637 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [DynamicValues] ([JsonValue], [Name], [Types])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 10:42:29.724 +04:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiValues] ([Comment], [CreatedAt], [KpiConfirmationId], [KpiId], [Status], [ValueId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-14 10:42:29.750 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 10:42:29.757 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi/AddValue  {
  "kpiValue": {
    "kpiId": 1,
    "dynamicValue": {
      "layers": [
        {
          "type": 1,
          "value": "string"
        }
      ],
      "name": "string"
    },
    "statusEnum": 1,
    "createdAt": "2025-08-14T06:42:18.717Z",
    "comment": "string"
  }
} Responded with [200] in 227ms
2025-08-14 10:42:29.763 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi/AddValue - 200 276 application/json 241.3144ms
2025-08-14 10:43:02.774 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi/AddValue - application/json 288
2025-08-14 10:43:02.780 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 10:43:02.792 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [DynamicValues] ([JsonValue], [Name], [Types])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 10:43:02.809 +04:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiValues] ([Comment], [CreatedAt], [KpiConfirmationId], [KpiId], [Status], [ValueId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-14 10:43:02.817 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 10:43:02.821 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi/AddValue  {
  "kpiValue": {
    "kpiId": 1,
    "dynamicValue": {
      "layers": [
        {
          "type": 1,
          "value": "[`Salam`,`Sagol`]"
        }
      ],
      "name": "string"
    },
    "statusEnum": 1,
    "createdAt": "2025-08-14T06:42:18.717Z",
    "comment": "string"
  }
} Responded with [200] in 41ms
2025-08-14 10:43:02.825 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi/AddValue - 200 276 application/json 51.3416ms
2025-08-14 10:43:07.714 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/Kpi - null null
2025-08-14 10:43:07.719 +04:00 [INF] Executing endpoint 'HTTP: GET /Kpi'
2025-08-14 10:43:08.065 +04:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [k].[Id], [k].[CompanyId], [k].[GriIndex], [k].[KpiGroupId], [k].[Name], [k].[TimePeriod], [k0].[Id], [k0].[Name], [s].[Id], [s].[Comment], [s].[CreatedAt], [s].[KpiConfirmationId], [s].[KpiId], [s].[Status], [s].[ValueId], [s].[Id0], [s].[JsonValue], [s].[Name], [s].[Types]
FROM [Kpis] AS [k]
INNER JOIN [KpiGroups] AS [k0] ON [k].[KpiGroupId] = [k0].[Id]
LEFT JOIN (
    SELECT [k1].[Id], [k1].[Comment], [k1].[CreatedAt], [k1].[KpiConfirmationId], [k1].[KpiId], [k1].[Status], [k1].[ValueId], [d].[Id] AS [Id0], [d].[JsonValue], [d].[Name], [d].[Types]
    FROM [KpiValues] AS [k1]
    INNER JOIN [DynamicValues] AS [d] ON [k1].[ValueId] = [d].[Id]
) AS [s] ON [k].[Id] = [s].[KpiId]
ORDER BY [k].[Id], [k0].[Id], [s].[Id]
2025-08-14 10:43:08.157 +04:00 [INF] Executed endpoint 'HTTP: GET /Kpi'
2025-08-14 10:43:08.182 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/Kpi   Responded with [200] in 463ms
2025-08-14 10:43:08.190 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/Kpi - 200 1100 application/json 476.2315ms
2025-08-14 10:43:35.357 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations - application/json 116
2025-08-14 10:43:35.363 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:43:35.433 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmations] ([CompletedAt], [CreatedAt], [CurrentStepNumber], [KpiGroupCompanyId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 10:43:35.443 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:43:35.449 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
KpiConfirmation -> StartKpiConfirmationResponse
KpiScope.Core.KpiGroupAggregate.KpiConfirmation -> KpiScope.Web.KpiConfirmation.StartConfirmation.StartKpiConfirmationResponse
   at lambda_method1682(Closure, Object, StartKpiConfirmationResponse, ResolutionContext)
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.StartConfirmationAsync(StartKpiConfirmationRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 34
   at KpiScope.Web.KpiConfirmation.StartConfirmation.StartKpiConfirmation.HandleAsync(StartKpiConfirmationRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\StartConfirmation\StartKpiConfirmation.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:43:35.467 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations  {
  "kpiGroupCompanyId": 1,
  "periodStart": "2025-08-14T06:40:41.889Z",
  "periodEnd": "2025-08-14T06:40:41.889Z"
} Responded with [500] in 104ms
2025-08-14 10:43:35.470 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations - 500 165 application/json 112.9508ms
2025-08-14 10:43:42.622 +04:00 [INF] Application is shutting down...
2025-08-14 10:44:11.246 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 10:44:11.325 +04:00 [INF] Registered 32 endpoints in 2,319 milliseconds.
2025-08-14 10:44:13.305 +04:00 [INF] Executed DbCommand (46ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:44:13.434 +04:00 [INF] Executed DbCommand (96ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:44:13.623 +04:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:44:13.687 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:44:13.788 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 10:44:13.837 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 10:44:14.362 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 10:44:14.363 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 10:44:14.363 +04:00 [INF] Hosting environment: Development
2025-08-14 10:44:14.363 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 10:44:34.514 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations - application/json 116
2025-08-14 10:44:34.709 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:44:53.426 +04:00 [INF] Executed DbCommand (26ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmations] ([CompletedAt], [CreatedAt], [CurrentStepNumber], [KpiGroupCompanyId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 10:45:01.144 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:45:01.148 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
KpiConfirmation -> StartKpiConfirmationResponse
KpiScope.Core.KpiGroupAggregate.KpiConfirmation -> KpiScope.Web.KpiConfirmation.StartConfirmation.StartKpiConfirmationResponse
   at lambda_method751(Closure, Object, StartKpiConfirmationResponse, ResolutionContext)
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.StartConfirmationAsync(StartKpiConfirmationRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 34
   at KpiScope.Web.KpiConfirmation.StartConfirmation.StartKpiConfirmation.HandleAsync(StartKpiConfirmationRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\StartConfirmation\StartKpiConfirmation.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:45:01.314 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations  {
  "kpiGroupCompanyId": 1,
  "periodStart": "2025-08-14T06:40:41.889Z",
  "periodEnd": "2025-08-14T06:40:41.889Z"
} Responded with [500] in 26606ms
2025-08-14 10:45:01.330 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations - 500 165 application/json 26819.1975ms
2025-08-14 10:46:51.384 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 10:46:51.483 +04:00 [INF] Registered 32 endpoints in 1,652 milliseconds.
2025-08-14 10:46:53.980 +04:00 [INF] Executed DbCommand (43ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:46:54.351 +04:00 [INF] Executed DbCommand (340ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:46:54.382 +04:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:46:54.387 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:46:54.608 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 10:46:54.686 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 10:46:55.390 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 10:46:55.390 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 10:46:55.390 +04:00 [INF] Hosting environment: Development
2025-08-14 10:46:55.391 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 10:47:01.008 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations - application/json 116
2025-08-14 10:47:01.231 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:47:05.202 +04:00 [INF] Executed DbCommand (95ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmations] ([CompletedAt], [CreatedAt], [CurrentStepNumber], [KpiGroupCompanyId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 10:47:05.647 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:47:05.652 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
KpiConfirmation -> StartKpiConfirmationResponse
KpiScope.Core.KpiGroupAggregate.KpiConfirmation -> KpiScope.Web.KpiConfirmation.StartConfirmation.StartKpiConfirmationResponse
   at lambda_method751(Closure, Object, StartKpiConfirmationResponse, ResolutionContext)
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.StartConfirmationAsync(StartKpiConfirmationRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 34
   at KpiScope.Web.KpiConfirmation.StartConfirmation.StartKpiConfirmation.HandleAsync(StartKpiConfirmationRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\StartConfirmation\StartKpiConfirmation.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:47:05.956 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations  {
  "kpiGroupCompanyId": 1,
  "periodStart": "2025-08-14T06:40:41.889Z",
  "periodEnd": "2025-08-14T06:40:41.889Z"
} Responded with [500] in 4714ms
2025-08-14 10:47:05.979 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations - 500 165 application/json 4977.011ms
2025-08-14 10:47:22.204 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 10:47:22.277 +04:00 [INF] Registered 32 endpoints in 1,614 milliseconds.
2025-08-14 10:47:24.727 +04:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:47:24.827 +04:00 [INF] Executed DbCommand (71ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:47:25.152 +04:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:47:25.155 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:47:25.254 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 10:47:25.294 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 10:47:25.840 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 10:47:25.841 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 10:47:25.841 +04:00 [INF] Hosting environment: Development
2025-08-14 10:47:25.842 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 10:47:31.834 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations - application/json 116
2025-08-14 10:47:32.052 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:47:40.907 +04:00 [INF] Executed DbCommand (29ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmations] ([CompletedAt], [CreatedAt], [CurrentStepNumber], [KpiGroupCompanyId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 10:48:09.983 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:48:09.987 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
KpiConfirmation -> StartKpiConfirmationResponse
KpiScope.Core.KpiGroupAggregate.KpiConfirmation -> KpiScope.Web.KpiConfirmation.StartConfirmation.StartKpiConfirmationResponse
   at lambda_method751(Closure, Object, StartKpiConfirmationResponse, ResolutionContext)
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.StartConfirmationAsync(StartKpiConfirmationRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 34
   at KpiScope.Web.KpiConfirmation.StartConfirmation.StartKpiConfirmation.HandleAsync(StartKpiConfirmationRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\StartConfirmation\StartKpiConfirmation.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:48:10.160 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations  {
  "kpiGroupCompanyId": 1,
  "periodStart": "2025-08-14T06:40:41.889Z",
  "periodEnd": "2025-08-14T06:40:41.889Z"
} Responded with [500] in 38112ms
2025-08-14 10:48:10.175 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations - 500 165 application/json 38343.395ms
2025-08-14 10:48:20.904 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations - application/json 116
2025-08-14 10:48:20.911 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:48:27.700 +04:00 [INF] Executed DbCommand (36ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmations] ([CompletedAt], [CreatedAt], [CurrentStepNumber], [KpiGroupCompanyId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 10:49:37.576 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:49:37.579 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
KpiConfirmation -> StartKpiConfirmationResponse
KpiScope.Core.KpiGroupAggregate.KpiConfirmation -> KpiScope.Web.KpiConfirmation.StartConfirmation.StartKpiConfirmationResponse
   at lambda_method751(Closure, Object, StartKpiConfirmationResponse, ResolutionContext)
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.StartConfirmationAsync(StartKpiConfirmationRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 34
   at KpiScope.Web.KpiConfirmation.StartConfirmation.StartKpiConfirmation.HandleAsync(StartKpiConfirmationRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\StartConfirmation\StartKpiConfirmation.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:49:37.591 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations  {
  "kpiGroupCompanyId": 1,
  "periodStart": "2025-08-14T06:40:41.889Z",
  "periodEnd": "2025-08-14T06:40:41.889Z"
} Responded with [500] in 76680ms
2025-08-14 10:49:37.594 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations - 500 165 application/json 76690.2663ms
2025-08-14 10:49:45.334 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/4 - null null
2025-08-14 10:49:45.338 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}'
2025-08-14 10:49:46.022 +04:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
FROM [KpiConfirmations] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 10:49:46.120 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}'
2025-08-14 10:49:46.266 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/4   Responded with [200] in 928ms
2025-08-14 10:49:46.267 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/4 - 200 292 application/json 932.3083ms
2025-08-14 10:50:00.085 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/4/steps - null null
2025-08-14 10:50:00.087 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 10:50:00.270 +04:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-08-14 10:50:00.342 +04:00 [INF] Executed DbCommand (30ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [k2].[Id], [k2].[CompletedAt], [k2].[CreatedAt], [k2].[CurrentStepNumber], [k2].[KpiGroupCompanyId], [k2].[Status], [s0].[Id], [s0].[CompletedAt], [s0].[KpiConfirmationId], [s0].[StartedAt], [s0].[Status], [s0].[StepNumber], [s0].[Id0], [s0].[ActionDate], [s0].[Comment], [s0].[IsConfirmed], [s0].[KpiConfirmationStepId], [s0].[UserId], [s0].[Id00], [s0].[CompanyId], [s0].[Email], [s0].[PasswordHash], [s0].[Username]
FROM (
    SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
    FROM [KpiConfirmations] AS [k]
    WHERE [k].[Id] = @__id_0
) AS [k2]
LEFT JOIN (
    SELECT [k0].[Id], [k0].[CompletedAt], [k0].[KpiConfirmationId], [k0].[StartedAt], [k0].[Status], [k0].[StepNumber], [s].[Id] AS [Id0], [s].[ActionDate], [s].[Comment], [s].[IsConfirmed], [s].[KpiConfirmationStepId], [s].[UserId], [s].[Id0] AS [Id00], [s].[CompanyId], [s].[Email], [s].[PasswordHash], [s].[Username]
    FROM [KpiConfirmationStep] AS [k0]
    LEFT JOIN (
        SELECT [k1].[Id], [k1].[ActionDate], [k1].[Comment], [k1].[IsConfirmed], [k1].[KpiConfirmationStepId], [k1].[UserId], [u].[Id] AS [Id0], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
        FROM [KpiConfirmationUsers] AS [k1]
        INNER JOIN [Users] AS [u] ON [k1].[UserId] = [u].[Id]
    ) AS [s] ON [k0].[Id] = [s].[KpiConfirmationStepId]
) AS [s0] ON [k2].[Id] = [s0].[KpiConfirmationId]
ORDER BY [k2].[Id], [s0].[Id], [s0].[Id0]
2025-08-14 10:50:00.383 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 10:50:00.386 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/4/steps   Responded with [200] in 299ms
2025-08-14 10:50:00.387 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/4/steps - 200 130 application/json 301.9749ms
2025-08-14 10:50:18.122 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/4/confirm - application/json 42
2025-08-14 10:50:18.125 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:50:18.227 +04:00 [INF] Executed DbCommand (28ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[ActionDate], [k].[Comment], [k].[IsConfirmed], [k].[KpiConfirmationStepId], [k].[UserId]
FROM [KpiConfirmationUsers] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 10:50:18.459 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:50:18.460 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: Step user 2 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.ConfirmKpiAsync(ConfirmKpiStepRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 69
   at KpiScope.Web.KpiConfirmation.ConfirmKpi.Confirm.HandleAsync(ConfirmKpiStepRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\ConfirmKpi\Confirm.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:50:18.467 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations/4/confirm  {
  "stepUserId": 2,
  "comment": "good"
} Responded with [500] in 341ms
2025-08-14 10:50:18.468 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/4/confirm - 500 165 application/json 345.6177ms
2025-08-14 10:52:12.788 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 10:52:12.842 +04:00 [INF] Registered 32 endpoints in 1,955 milliseconds.
2025-08-14 10:52:15.268 +04:00 [INF] Executed DbCommand (119ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:52:15.448 +04:00 [INF] Executed DbCommand (115ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:52:15.751 +04:00 [INF] Executed DbCommand (46ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:52:15.755 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:52:15.881 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 10:52:15.939 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 10:52:16.527 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 10:52:16.528 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 10:52:16.528 +04:00 [INF] Hosting environment: Development
2025-08-14 10:52:16.528 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 10:52:16.951 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations - application/json 116
2025-08-14 10:52:17.240 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:52:22.137 +04:00 [INF] Executed DbCommand (34ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmations] ([CompletedAt], [CreatedAt], [CurrentStepNumber], [KpiGroupCompanyId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 10:52:22.269 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 10:52:22.604 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations  {
  "kpiGroupCompanyId": 1,
  "periodStart": "2025-08-14T06:40:41.889Z",
  "periodEnd": "2025-08-14T06:40:41.889Z"
} Responded with [200] in 5359ms
2025-08-14 10:52:22.629 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations - 200 169 application/json 5682.9509ms
2025-08-14 10:54:48.940 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 10:54:49.007 +04:00 [INF] Registered 32 endpoints in 2,514 milliseconds.
2025-08-14 10:54:50.669 +04:00 [INF] Executed DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:54:50.816 +04:00 [INF] Executed DbCommand (115ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:54:51.021 +04:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 10:54:51.088 +04:00 [INF] Executed DbCommand (65ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 10:54:51.289 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 10:54:51.382 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 10:54:52.159 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 10:54:52.161 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 10:54:52.161 +04:00 [INF] Hosting environment: Development
2025-08-14 10:54:52.162 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 10:54:52.564 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - application/json 42
2025-08-14 10:54:52.761 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:54:53.601 +04:00 [INF] Executed DbCommand (38ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[ActionDate], [k].[Comment], [k].[IsConfirmed], [k].[KpiConfirmationStepId], [k].[UserId]
FROM [KpiConfirmationUsers] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 10:54:54.011 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:54:54.015 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: Step user 2 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.ConfirmKpiAsync(ConfirmKpiStepRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 69
   at KpiScope.Web.KpiConfirmation.ConfirmKpi.Confirm.HandleAsync(ConfirmKpiStepRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\ConfirmKpi\Confirm.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:54:54.183 +04:00 [INF] Source:[127.0.0.1] Request: POST https localhost:57679/kpiConfirmations/6/confirm  {
  "stepUserId": 2,
  "comment": "good"
} Responded with [500] in 1421ms
2025-08-14 10:54:54.201 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - 500 165 application/json 1642.1634ms
2025-08-14 10:54:56.973 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - application/json 42
2025-08-14 10:54:56.980 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:54:56.995 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[ActionDate], [k].[Comment], [k].[IsConfirmed], [k].[KpiConfirmationStepId], [k].[UserId]
FROM [KpiConfirmationUsers] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 10:54:57.179 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:54:57.179 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: Step user 2 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.ConfirmKpiAsync(ConfirmKpiStepRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 69
   at KpiScope.Web.KpiConfirmation.ConfirmKpi.Confirm.HandleAsync(ConfirmKpiStepRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\ConfirmKpi\Confirm.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:54:57.183 +04:00 [INF] Source:[127.0.0.1] Request: POST https localhost:57679/kpiConfirmations/6/confirm  {
  "stepUserId": 2,
  "comment": "good"
} Responded with [500] in 203ms
2025-08-14 10:54:57.184 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - 500 165 application/json 211.379ms
2025-08-14 10:55:28.124 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - application/json 42
2025-08-14 10:55:28.126 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:55:31.947 +04:00 [INF] Executed DbCommand (45ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[ActionDate], [k].[Comment], [k].[IsConfirmed], [k].[KpiConfirmationStepId], [k].[UserId]
FROM [KpiConfirmationUsers] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 10:55:32.142 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:55:32.142 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: Step user 2 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.ConfirmKpiAsync(ConfirmKpiStepRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 69
   at KpiScope.Web.KpiConfirmation.ConfirmKpi.Confirm.HandleAsync(ConfirmKpiStepRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\ConfirmKpi\Confirm.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:55:32.144 +04:00 [INF] Source:[127.0.0.1] Request: POST https localhost:57679/kpiConfirmations/6/confirm  {
  "stepUserId": 2,
  "comment": "good"
} Responded with [500] in 4018ms
2025-08-14 10:55:32.144 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - 500 165 application/json 4019.8966ms
2025-08-14 10:55:59.447 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - application/json 42
2025-08-14 10:55:59.448 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:56:02.261 +04:00 [INF] Executed DbCommand (18ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[ActionDate], [k].[Comment], [k].[IsConfirmed], [k].[KpiConfirmationStepId], [k].[UserId]
FROM [KpiConfirmationUsers] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 10:56:02.632 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:56:02.634 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: Step user 1 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.ConfirmKpiAsync(ConfirmKpiStepRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 69
   at KpiScope.Web.KpiConfirmation.ConfirmKpi.Confirm.HandleAsync(ConfirmKpiStepRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\ConfirmKpi\Confirm.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:56:02.637 +04:00 [INF] Source:[127.0.0.1] Request: POST https localhost:57679/kpiConfirmations/6/confirm  {
  "stepUserId": 1,
  "comment": "good"
} Responded with [500] in 3189ms
2025-08-14 10:56:02.638 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - 500 165 application/json 3190.9203ms
2025-08-14 10:56:06.422 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - application/json 42
2025-08-14 10:56:06.423 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:56:15.579 +04:00 [INF] Executed DbCommand (73ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[ActionDate], [k].[Comment], [k].[IsConfirmed], [k].[KpiConfirmationStepId], [k].[UserId]
FROM [KpiConfirmationUsers] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 10:56:16.045 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:56:16.046 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: Step user 1 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.ConfirmKpiAsync(ConfirmKpiStepRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 69
   at KpiScope.Web.KpiConfirmation.ConfirmKpi.Confirm.HandleAsync(ConfirmKpiStepRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\ConfirmKpi\Confirm.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:56:16.048 +04:00 [INF] Source:[127.0.0.1] Request: POST https localhost:57679/kpiConfirmations/6/confirm  {
  "stepUserId": 1,
  "comment": "good"
} Responded with [500] in 9624ms
2025-08-14 10:56:16.048 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - 500 165 application/json 9626.2013ms
2025-08-14 10:56:22.835 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - application/json 42
2025-08-14 10:56:22.836 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:56:35.783 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[ActionDate], [k].[Comment], [k].[IsConfirmed], [k].[KpiConfirmationStepId], [k].[UserId]
FROM [KpiConfirmationUsers] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 10:56:36.002 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 10:56:36.002 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: Step user 1 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.ConfirmKpiAsync(ConfirmKpiStepRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 69
   at KpiScope.Web.KpiConfirmation.ConfirmKpi.Confirm.HandleAsync(ConfirmKpiStepRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\ConfirmKpi\Confirm.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 10:56:36.004 +04:00 [INF] Source:[127.0.0.1] Request: POST https localhost:57679/kpiConfirmations/6/confirm  {
  "stepUserId": 1,
  "comment": "good"
} Responded with [500] in 13167ms
2025-08-14 10:56:36.004 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - 500 165 application/json 13169.1382ms
2025-08-14 11:37:35.401 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 11:37:35.463 +04:00 [INF] Registered 32 endpoints in 2,424 milliseconds.
2025-08-14 11:37:37.219 +04:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 11:37:37.385 +04:00 [INF] Executed DbCommand (148ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 11:37:37.618 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 11:37:37.620 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 11:37:37.760 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 11:37:37.810 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 11:37:38.182 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 11:37:38.183 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 11:37:38.183 +04:00 [INF] Hosting environment: Development
2025-08-14 11:37:38.183 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 11:38:07.498 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations - application/json 116
2025-08-14 11:38:07.706 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 11:38:08.355 +04:00 [INF] Executed DbCommand (82ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmations] ([CompletedAt], [CreatedAt], [CurrentStepNumber], [KpiGroupCompanyId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 11:38:08.459 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 11:38:08.698 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations  {
  "kpiGroupCompanyId": 1,
  "periodStart": "2025-08-14T06:40:41.889Z",
  "periodEnd": "2025-08-14T06:40:41.889Z"
} Responded with [200] in 993ms
2025-08-14 11:38:08.712 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations - 200 169 application/json 1215.5137ms
2025-08-14 11:38:25.392 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - application/json 42
2025-08-14 11:38:25.394 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 11:38:25.810 +04:00 [INF] Executed DbCommand (22ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[ActionDate], [k].[Comment], [k].[IsConfirmed], [k].[KpiConfirmationStepId], [k].[UserId]
FROM [KpiConfirmationUsers] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 11:38:26.381 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 11:38:26.384 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: Step user 1 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.ConfirmKpiAsync(ConfirmKpiStepRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 69
   at KpiScope.Web.KpiConfirmation.ConfirmKpi.Confirm.HandleAsync(ConfirmKpiStepRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\ConfirmKpi\Confirm.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 11:38:26.410 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations/6/confirm  {
  "stepUserId": 1,
  "comment": "good"
} Responded with [500] in 1015ms
2025-08-14 11:38:26.411 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - 500 165 application/json 1019.0687ms
2025-08-14 11:38:44.364 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/swagger/index.html - null null
2025-08-14 11:38:44.391 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/swagger/index.html - 200 null text/html; charset=utf-8 27.5055ms
2025-08-14 11:38:44.956 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/swagger/v1/swagger.json - null null
2025-08-14 11:38:45.988 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/swagger/v1/swagger.json - 200 null application/json; charset=utf-8 1031.0597ms
2025-08-14 11:39:16.803 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/6/confirm - null null
2025-08-14 11:39:16.806 +04:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-08-14 11:39:16.807 +04:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-08-14 11:39:16.812 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/6/confirm   Responded with [405] in 6ms
2025-08-14 11:39:16.812 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/6/confirm - 405 149 application/json 9.368ms
2025-08-14 11:39:25.143 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/swagger/index.html - null null
2025-08-14 11:39:25.145 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/swagger/index.html - 200 null text/html; charset=utf-8 1.6926ms
2025-08-14 11:39:25.742 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/swagger/v1/swagger.json - null null
2025-08-14 11:39:25.743 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/swagger/v1/swagger.json - 200 null application/json; charset=utf-8 1.1091ms
2025-08-14 11:56:27.803 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 11:56:27.869 +04:00 [INF] Registered 32 endpoints in 1,132 milliseconds.
2025-08-14 11:56:29.170 +04:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 11:56:29.378 +04:00 [INF] Executed DbCommand (188ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 11:56:29.407 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 11:56:29.413 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 11:56:29.475 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 11:56:29.500 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 11:56:29.805 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 11:56:29.807 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 11:56:29.808 +04:00 [INF] Hosting environment: Development
2025-08-14 11:56:29.810 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 11:56:32.522 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/swagger/index.html - null null
2025-08-14 11:56:32.679 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/swagger/index.html - 200 null text/html; charset=utf-8 157.0631ms
2025-08-14 11:56:33.258 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/swagger/v1/swagger.json - null null
2025-08-14 11:56:34.014 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/swagger/v1/swagger.json - 200 null application/json; charset=utf-8 755.4719ms
2025-08-14 11:56:58.120 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - application/json 91
2025-08-14 11:56:58.136 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 11:56:58.698 +04:00 [INF] Executed DbCommand (49ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmationUsers] ([ActionDate], [Comment], [IsConfirmed], [KpiConfirmationStepId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 11:56:58.751 +04:00 [ERR] An exception occurred in the database while saving changes for context type 'KpiScope.Infrastructure.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'KpiConfirmationStepId', table 'KPI.dbo.KpiConfirmationUsers'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4c319000-f915-4099-b7b5-af38a17018a7
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'KpiConfirmationStepId', table 'KPI.dbo.KpiConfirmationUsers'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4c319000-f915-4099-b7b5-af38a17018a7
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-14 11:56:58.772 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 11:56:58.779 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'KpiConfirmationStepId', table 'KPI.dbo.KpiConfirmationUsers'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4c319000-f915-4099-b7b5-af38a17018a7
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.SaveChangesAsync(CancellationToken cancellationToken)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.AddAsync(T entity, CancellationToken cancellationToken)
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.ConfirmKpiAsync(ConfirmKpiStepRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 67
   at KpiScope.Web.KpiConfirmation.ConfirmKpi.Confirm.HandleAsync(ConfirmKpiStepRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\ConfirmKpi\Confirm.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 11:56:58.834 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations/6/confirm  {
  "stepUserId": 2,
  "kpiGroupCompanyId": 1,
  "confirmationId": 1,
  "comment": "good"
} Responded with [500] in 694ms
2025-08-14 11:56:58.843 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - 500 165 application/json 722.6461ms
2025-08-14 11:57:10.462 +04:00 [INF] Application is shutting down...
2025-08-14 11:57:23.931 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 11:57:23.987 +04:00 [INF] Registered 32 endpoints in 947 milliseconds.
2025-08-14 11:57:25.292 +04:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 11:57:25.408 +04:00 [INF] Executed DbCommand (85ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 11:57:25.626 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 11:57:25.628 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 11:57:25.690 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 11:57:25.719 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 11:57:25.991 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 11:57:25.991 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 11:57:25.991 +04:00 [INF] Hosting environment: Development
2025-08-14 11:57:25.991 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 11:57:48.965 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - application/json 91
2025-08-14 11:57:49.141 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 11:57:53.579 +04:00 [INF] Executed DbCommand (43ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmationUsers] ([ActionDate], [Comment], [IsConfirmed], [KpiConfirmationStepId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 11:57:53.610 +04:00 [ERR] An exception occurred in the database while saving changes for context type 'KpiScope.Infrastructure.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'KpiConfirmationStepId', table 'KPI.dbo.KpiConfirmationUsers'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:437b18d6-834b-4679-97f9-05d70835d82c
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'KpiConfirmationStepId', table 'KPI.dbo.KpiConfirmationUsers'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:437b18d6-834b-4679-97f9-05d70835d82c
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-14 11:57:54.181 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 11:57:54.184 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'KpiConfirmationStepId', table 'KPI.dbo.KpiConfirmationUsers'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:437b18d6-834b-4679-97f9-05d70835d82c
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.SaveChangesAsync(CancellationToken cancellationToken)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.AddAsync(T entity, CancellationToken cancellationToken)
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.ConfirmKpiAsync(ConfirmKpiStepRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 67
   at KpiScope.Web.KpiConfirmation.ConfirmKpi.Confirm.HandleAsync(ConfirmKpiStepRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\ConfirmKpi\Confirm.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 11:57:54.382 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations/6/confirm  {
  "stepUserId": 2,
  "kpiGroupCompanyId": 1,
  "confirmationId": 1,
  "comment": "good"
} Responded with [500] in 5237ms
2025-08-14 11:57:54.496 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - 500 165 application/json 5531.8496ms
2025-08-14 11:58:33.334 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 11:58:33.440 +04:00 [INF] Registered 32 endpoints in 1,798 milliseconds.
2025-08-14 11:58:35.610 +04:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 11:58:35.696 +04:00 [INF] Executed DbCommand (68ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 11:58:35.884 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 11:58:38.997 +04:00 [INF] Executed DbCommand (3,069ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [KPI] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-08-14 11:58:39.165 +04:00 [INF] Executed DbCommand (168ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [KPI];
2025-08-14 11:58:39.486 +04:00 [INF] Executed DbCommand (228ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [KPI];
2025-08-14 11:58:39.547 +04:00 [INF] Executed DbCommand (61ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [KPI] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-08-14 11:58:39.585 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 11:58:39.723 +04:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Companies] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [Address] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Companies] PRIMARY KEY ([Id])
);
2025-08-14 11:58:39.726 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [DynamicValues] (
    [Id] int NOT NULL IDENTITY,
    [Types] nvarchar(max) NOT NULL,
    [JsonValue] nvarchar(max) NOT NULL,
    [Name] nvarchar(max) NULL,
    CONSTRAINT [PK_DynamicValues] PRIMARY KEY ([Id])
);
2025-08-14 11:58:39.729 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiGroups] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_KpiGroups] PRIMARY KEY ([Id])
);
2025-08-14 11:58:39.732 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [Id] int NOT NULL IDENTITY,
    [Username] nvarchar(max) NOT NULL,
    [Email] nvarchar(max) NOT NULL,
    [PasswordHash] nvarchar(max) NOT NULL,
    [CompanyId] int NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Users_Companies_CompanyId] FOREIGN KEY ([CompanyId]) REFERENCES [Companies] ([Id]) ON DELETE CASCADE
);
2025-08-14 11:58:39.735 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Kpis] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [GriIndex] int NOT NULL,
    [TimePeriod] int NOT NULL,
    [KpiGroupId] int NOT NULL,
    [CompanyId] int NULL,
    CONSTRAINT [PK_Kpis] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Kpis_Companies_CompanyId] FOREIGN KEY ([CompanyId]) REFERENCES [Companies] ([Id]),
    CONSTRAINT [FK_Kpis_KpiGroups_KpiGroupId] FOREIGN KEY ([KpiGroupId]) REFERENCES [KpiGroups] ([Id]) ON DELETE CASCADE
);
2025-08-14 11:58:39.738 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiGroupCompanys] (
    [Id] int NOT NULL IDENTITY,
    [KpiGroupId] int NOT NULL,
    [CompanyId] int NOT NULL,
    [UserId] int NOT NULL,
    CONSTRAINT [PK_KpiGroupCompanys] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiGroupCompanys_Companies_CompanyId] FOREIGN KEY ([CompanyId]) REFERENCES [Companies] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_KpiGroupCompanys_KpiGroups_KpiGroupId] FOREIGN KEY ([KpiGroupId]) REFERENCES [KpiGroups] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_KpiGroupCompanys_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE NO ACTION
);
2025-08-14 11:58:39.740 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiConfirmations] (
    [Id] int NOT NULL IDENTITY,
    [KpiGroupCompanyId] int NOT NULL,
    [Status] int NOT NULL,
    [CurrentStepNumber] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [CompletedAt] datetime2 NULL,
    CONSTRAINT [PK_KpiConfirmations] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiConfirmations_KpiGroupCompanys_KpiGroupCompanyId] FOREIGN KEY ([KpiGroupCompanyId]) REFERENCES [KpiGroupCompanys] ([Id]) ON DELETE CASCADE
);
2025-08-14 11:58:39.743 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiConfirmationStep] (
    [Id] int NOT NULL IDENTITY,
    [KpiConfirmationId] int NOT NULL,
    [StepNumber] int NOT NULL,
    [Status] int NOT NULL,
    [StartedAt] datetime2 NULL,
    [CompletedAt] datetime2 NULL,
    CONSTRAINT [PK_KpiConfirmationStep] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiConfirmationStep_KpiConfirmations_KpiConfirmationId] FOREIGN KEY ([KpiConfirmationId]) REFERENCES [KpiConfirmations] ([Id]) ON DELETE CASCADE
);
2025-08-14 11:58:39.746 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiValues] (
    [Id] int NOT NULL IDENTITY,
    [KpiId] int NOT NULL,
    [ValueId] int NOT NULL,
    [Status] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [Comment] nvarchar(max) NOT NULL,
    [KpiConfirmationId] int NULL,
    CONSTRAINT [PK_KpiValues] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiValues_DynamicValues_ValueId] FOREIGN KEY ([ValueId]) REFERENCES [DynamicValues] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_KpiValues_KpiConfirmations_KpiConfirmationId] FOREIGN KEY ([KpiConfirmationId]) REFERENCES [KpiConfirmations] ([Id]),
    CONSTRAINT [FK_KpiValues_Kpis_KpiId] FOREIGN KEY ([KpiId]) REFERENCES [Kpis] ([Id]) ON DELETE CASCADE
);
2025-08-14 11:58:39.748 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiConfirmationUsers] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [IsConfirmed] bit NULL,
    [Comment] nvarchar(max) NOT NULL,
    [ActionDate] datetime2 NULL,
    [KpiConfirmationStepId] int NULL,
    CONSTRAINT [PK_KpiConfirmationUsers] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiConfirmationUsers_KpiConfirmationStep_KpiConfirmationStepId] FOREIGN KEY ([KpiConfirmationStepId]) REFERENCES [KpiConfirmationStep] ([Id]),
    CONSTRAINT [FK_KpiConfirmationUsers_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE NO ACTION
);
2025-08-14 11:58:39.751 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmations_KpiGroupCompanyId] ON [KpiConfirmations] ([KpiGroupCompanyId]);
2025-08-14 11:58:39.752 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmationStep_KpiConfirmationId] ON [KpiConfirmationStep] ([KpiConfirmationId]);
2025-08-14 11:58:39.754 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmationUsers_KpiConfirmationStepId] ON [KpiConfirmationUsers] ([KpiConfirmationStepId]);
2025-08-14 11:58:39.755 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmationUsers_UserId] ON [KpiConfirmationUsers] ([UserId]);
2025-08-14 11:58:39.757 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiGroupCompanys_CompanyId] ON [KpiGroupCompanys] ([CompanyId]);
2025-08-14 11:58:39.758 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiGroupCompanys_KpiGroupId] ON [KpiGroupCompanys] ([KpiGroupId]);
2025-08-14 11:58:39.760 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiGroupCompanys_UserId] ON [KpiGroupCompanys] ([UserId]);
2025-08-14 11:58:39.761 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Kpis_CompanyId] ON [Kpis] ([CompanyId]);
2025-08-14 11:58:39.762 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Kpis_KpiGroupId] ON [Kpis] ([KpiGroupId]);
2025-08-14 11:58:39.763 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiValues_KpiConfirmationId] ON [KpiValues] ([KpiConfirmationId]);
2025-08-14 11:58:39.764 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiValues_KpiId] ON [KpiValues] ([KpiId]);
2025-08-14 11:58:39.766 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiValues_ValueId] ON [KpiValues] ([ValueId]);
2025-08-14 11:58:39.767 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Users_CompanyId] ON [Users] ([CompanyId]);
2025-08-14 11:58:39.828 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 11:58:39.906 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 11:58:40.148 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 11:58:40.148 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 11:58:40.148 +04:00 [INF] Hosting environment: Development
2025-08-14 11:58:40.148 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 11:58:49.928 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - application/json 91
2025-08-14 11:58:50.026 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 11:58:55.420 +04:00 [INF] Executed DbCommand (56ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmationUsers] ([ActionDate], [Comment], [IsConfirmed], [KpiConfirmationStepId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 11:58:55.468 +04:00 [ERR] An exception occurred in the database while saving changes for context type 'KpiScope.Infrastructure.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_KpiConfirmationUsers_Users_UserId". The conflict occurred in database "KPI", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:174dee77-577f-44b4-894a-1a15fe94d800
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_KpiConfirmationUsers_Users_UserId". The conflict occurred in database "KPI", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:174dee77-577f-44b4-894a-1a15fe94d800
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-14 11:58:55.990 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 11:58:55.996 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_KpiConfirmationUsers_Users_UserId". The conflict occurred in database "KPI", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:174dee77-577f-44b4-894a-1a15fe94d800
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.SaveChangesAsync(CancellationToken cancellationToken)
   at Ardalis.Specification.EntityFrameworkCore.RepositoryBase`1.AddAsync(T entity, CancellationToken cancellationToken)
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.ConfirmKpiAsync(ConfirmKpiStepRequest request) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 67
   at KpiScope.Web.KpiConfirmation.ConfirmKpi.Confirm.HandleAsync(ConfirmKpiStepRequest request, CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\ConfirmKpi\Confirm.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 11:58:56.164 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations/6/confirm  {
  "stepUserId": 2,
  "kpiGroupCompanyId": 1,
  "confirmationId": 1,
  "comment": "good"
} Responded with [500] in 6131ms
2025-08-14 11:58:56.175 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/6/confirm - 500 165 application/json 6247.3201ms
2025-08-14 11:59:02.159 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Companies - application/json 45
2025-08-14 11:59:02.162 +04:00 [INF] Executing endpoint 'HTTP: POST /Companies'
2025-08-14 11:59:02.202 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Companies] ([Address], [Name])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1);
2025-08-14 11:59:02.243 +04:00 [INF] Executed endpoint 'HTTP: POST /Companies'
2025-08-14 11:59:02.296 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Companies  {
  "name": "string",
  "address": "string"
} Responded with [200] in 134ms
2025-08-14 11:59:02.297 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Companies - 200 150 application/json 137.6689ms
2025-08-14 11:59:15.275 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/auth/Register - application/json 100
2025-08-14 11:59:15.276 +04:00 [INF] Executing endpoint 'HTTP: POST auth/Register'
2025-08-14 11:59:15.606 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@__mail_0='?' (Size = 4000), @__username_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Email] = @__mail_0 OR [u].[Username] = @__username_1
2025-08-14 11:59:15.624 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CompanyId], [Email], [PasswordHash], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2025-08-14 11:59:15.646 +04:00 [INF] Executed DbCommand (15ms) [Parameters=[@p4='?' (DbType = Int32), @p0='?' (DbType = Int32), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Users] SET [CompanyId] = @p0, [Email] = @p1, [PasswordHash] = @p2, [Username] = @p3
OUTPUT 1
WHERE [Id] = @p4;
2025-08-14 11:59:15.651 +04:00 [INF] Executed endpoint 'HTTP: POST auth/Register'
2025-08-14 11:59:15.652 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/auth/Register  {
  "username": "string",
  "password": "string",
  "email": "user@example.com",
  "comapanyId": 1
} Responded with [200] in 376ms
2025-08-14 11:59:15.652 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/auth/Register - 200 162 application/json 377.2488ms
2025-08-14 11:59:28.306 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/KpiGroups - application/json 30
2025-08-14 11:59:28.307 +04:00 [INF] Executing endpoint 'HTTP: POST /KpiGroups'
2025-08-14 11:59:28.344 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiGroups] ([Name])
OUTPUT INSERTED.[Id]
VALUES (@p0);
2025-08-14 11:59:28.350 +04:00 [INF] Executed endpoint 'HTTP: POST /KpiGroups'
2025-08-14 11:59:28.352 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/KpiGroups  {
  "name": "KPI Group Name"
} Responded with [200] in 44ms
2025-08-14 11:59:28.352 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/KpiGroups - 200 132 application/json 45.6618ms
2025-08-14 11:59:36.537 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/KpiGroupCompanies - application/json 54
2025-08-14 11:59:36.539 +04:00 [INF] Executing endpoint 'HTTP: POST /KpiGroupCompanies'
2025-08-14 11:59:36.594 +04:00 [INF] Executed DbCommand (21ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiGroupCompanys] ([CompanyId], [KpiGroupId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 11:59:36.602 +04:00 [INF] Executed endpoint 'HTTP: POST /KpiGroupCompanies'
2025-08-14 11:59:36.604 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/KpiGroupCompanies  {
  "kpiGroupId": 1,
  "companyId": 1,
  "userId": 1
} Responded with [200] in 65ms
2025-08-14 11:59:36.605 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/KpiGroupCompanies - 200 162 application/json 68.3527ms
2025-08-14 11:59:53.076 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi - application/json 77
2025-08-14 11:59:53.076 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi'
2025-08-14 11:59:53.144 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Kpis] ([CompanyId], [GriIndex], [KpiGroupId], [Name], [TimePeriod])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 11:59:53.155 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi'
2025-08-14 11:59:53.156 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi  {
  "name": "string",
  "griIndex": 1,
  "timePeriod": 1,
  "kpiGroupId": 1
} Responded with [200] in 79ms
2025-08-14 11:59:53.156 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi - 200 188 application/json 80.6178ms
2025-08-14 12:00:18.590 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi/AddValue - application/json 277
2025-08-14 12:00:18.599 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:00:18.664 +04:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [DynamicValues] ([JsonValue], [Name], [Types])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 12:00:18.709 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiValues] ([Comment], [CreatedAt], [KpiConfirmationId], [KpiId], [Status], [ValueId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-14 12:00:18.724 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:00:18.726 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi/AddValue  {
  "kpiValue": {
    "kpiId": 1,
    "dynamicValue": {
      "layers": [
        {
          "type": 1,
          "value": "string"
        }
      ],
      "name": "string"
    },
    "statusEnum": 1,
    "createdAt": "2025-08-14T07:59:58.424Z",
    "comment": "string"
  }
} Responded with [200] in 127ms
2025-08-14 12:00:18.727 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi/AddValue - 200 276 application/json 136.9591ms
2025-08-14 12:00:42.634 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi/AddValue - application/json 288
2025-08-14 12:00:42.660 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:00:42.669 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [DynamicValues] ([JsonValue], [Name], [Types])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 12:00:42.674 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiValues] ([Comment], [CreatedAt], [KpiConfirmationId], [KpiId], [Status], [ValueId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-14 12:00:42.675 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:00:42.675 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi/AddValue  {
  "kpiValue": {
    "kpiId": 1,
    "dynamicValue": {
      "layers": [
        {
          "type": 1,
          "value": "['slalm','sagol']"
        }
      ],
      "name": "string"
    },
    "statusEnum": 1,
    "createdAt": "2025-08-14T07:59:58.424Z",
    "comment": "string"
  }
} Responded with [200] in 38ms
2025-08-14 12:00:42.676 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi/AddValue - 200 276 application/json 41.8727ms
2025-08-14 12:00:57.668 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations - application/json 116
2025-08-14 12:00:57.669 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 12:00:57.703 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmations] ([CompletedAt], [CreatedAt], [CurrentStepNumber], [KpiGroupCompanyId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 12:00:57.717 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 12:00:57.722 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations  {
  "kpiGroupCompanyId": 1,
  "periodStart": "2025-08-14T08:00:53.868Z",
  "periodEnd": "2025-08-14T08:00:53.868Z"
} Responded with [200] in 53ms
2025-08-14 12:00:57.722 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations - 200 169 application/json 54.4044ms
2025-08-14 12:01:06.019 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/1/confirm - application/json 91
2025-08-14 12:01:06.020 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 12:01:10.217 +04:00 [INF] Executed DbCommand (22ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmationUsers] ([ActionDate], [Comment], [IsConfirmed], [KpiConfirmationStepId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 12:01:12.865 +04:00 [INF] Executed DbCommand (25ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
FROM [KpiConfirmations] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 12:01:15.397 +04:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p6='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [KpiConfirmationStep] ([CompletedAt], [KpiConfirmationId], [StartedAt], [Status], [StepNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [KpiConfirmations] SET [CurrentStepNumber] = @p5
OUTPUT 1
WHERE [Id] = @p6;
2025-08-14 12:01:15.404 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p8='?' (DbType = Int32), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [KpiConfirmationUsers] SET [KpiConfirmationStepId] = @p7
OUTPUT 1
WHERE [Id] = @p8;
2025-08-14 12:01:21.377 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 12:01:21.378 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations/1/confirm  {
  "stepUserId": 1,
  "kpiGroupCompanyId": 1,
  "confirmationId": 1,
  "comment": "good"
} Responded with [200] in 15357ms
2025-08-14 12:01:21.379 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/1/confirm - 200 131 application/json 15359.885ms
2025-08-14 12:01:33.427 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1 - null null
2025-08-14 12:01:33.427 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}'
2025-08-14 12:01:33.544 +04:00 [INF] Executed DbCommand (27ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
FROM [KpiConfirmations] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 12:01:33.566 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}'
2025-08-14 12:01:33.568 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/1   Responded with [200] in 140ms
2025-08-14 12:01:33.568 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/1 - 200 292 application/json 140.9672ms
2025-08-14 12:01:46.559 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - null null
2025-08-14 12:01:46.559 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:01:46.716 +04:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-08-14 12:01:46.789 +04:00 [INF] Executed DbCommand (41ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [k2].[Id], [k2].[CompletedAt], [k2].[CreatedAt], [k2].[CurrentStepNumber], [k2].[KpiGroupCompanyId], [k2].[Status], [s0].[Id], [s0].[CompletedAt], [s0].[KpiConfirmationId], [s0].[StartedAt], [s0].[Status], [s0].[StepNumber], [s0].[Id0], [s0].[ActionDate], [s0].[Comment], [s0].[IsConfirmed], [s0].[KpiConfirmationStepId], [s0].[UserId], [s0].[Id00], [s0].[CompanyId], [s0].[Email], [s0].[PasswordHash], [s0].[Username]
FROM (
    SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
    FROM [KpiConfirmations] AS [k]
    WHERE [k].[Id] = @__id_0
) AS [k2]
LEFT JOIN (
    SELECT [k0].[Id], [k0].[CompletedAt], [k0].[KpiConfirmationId], [k0].[StartedAt], [k0].[Status], [k0].[StepNumber], [s].[Id] AS [Id0], [s].[ActionDate], [s].[Comment], [s].[IsConfirmed], [s].[KpiConfirmationStepId], [s].[UserId], [s].[Id0] AS [Id00], [s].[CompanyId], [s].[Email], [s].[PasswordHash], [s].[Username]
    FROM [KpiConfirmationStep] AS [k0]
    LEFT JOIN (
        SELECT [k1].[Id], [k1].[ActionDate], [k1].[Comment], [k1].[IsConfirmed], [k1].[KpiConfirmationStepId], [k1].[UserId], [u].[Id] AS [Id0], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
        FROM [KpiConfirmationUsers] AS [k1]
        INNER JOIN [Users] AS [u] ON [k1].[UserId] = [u].[Id]
    ) AS [s] ON [k0].[Id] = [s].[KpiConfirmationStepId]
) AS [s0] ON [k2].[Id] = [s0].[KpiConfirmationId]
ORDER BY [k2].[Id], [s0].[Id], [s0].[Id0]
2025-08-14 12:01:46.820 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:01:46.820 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/1/steps   Responded with [200] in 260ms
2025-08-14 12:01:46.821 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - 200 288 application/json 261.5403ms
2025-08-14 12:05:27.162 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - null null
2025-08-14 12:05:27.199 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:05:27.216 +04:00 [INF] Executed DbCommand (14ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [k2].[Id], [k2].[CompletedAt], [k2].[CreatedAt], [k2].[CurrentStepNumber], [k2].[KpiGroupCompanyId], [k2].[Status], [s0].[Id], [s0].[CompletedAt], [s0].[KpiConfirmationId], [s0].[StartedAt], [s0].[Status], [s0].[StepNumber], [s0].[Id0], [s0].[ActionDate], [s0].[Comment], [s0].[IsConfirmed], [s0].[KpiConfirmationStepId], [s0].[UserId], [s0].[Id00], [s0].[CompanyId], [s0].[Email], [s0].[PasswordHash], [s0].[Username]
FROM (
    SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
    FROM [KpiConfirmations] AS [k]
    WHERE [k].[Id] = @__id_0
) AS [k2]
LEFT JOIN (
    SELECT [k0].[Id], [k0].[CompletedAt], [k0].[KpiConfirmationId], [k0].[StartedAt], [k0].[Status], [k0].[StepNumber], [s].[Id] AS [Id0], [s].[ActionDate], [s].[Comment], [s].[IsConfirmed], [s].[KpiConfirmationStepId], [s].[UserId], [s].[Id0] AS [Id00], [s].[CompanyId], [s].[Email], [s].[PasswordHash], [s].[Username]
    FROM [KpiConfirmationStep] AS [k0]
    LEFT JOIN (
        SELECT [k1].[Id], [k1].[ActionDate], [k1].[Comment], [k1].[IsConfirmed], [k1].[KpiConfirmationStepId], [k1].[UserId], [u].[Id] AS [Id0], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
        FROM [KpiConfirmationUsers] AS [k1]
        INNER JOIN [Users] AS [u] ON [k1].[UserId] = [u].[Id]
    ) AS [s] ON [k0].[Id] = [s].[KpiConfirmationStepId]
) AS [s0] ON [k2].[Id] = [s0].[KpiConfirmationId]
ORDER BY [k2].[Id], [s0].[Id], [s0].[Id0]
2025-08-14 12:05:27.218 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:05:27.218 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/1/steps   Responded with [200] in 19ms
2025-08-14 12:05:27.219 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - 200 288 application/json 57.0422ms
2025-08-14 12:06:51.616 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - null null
2025-08-14 12:06:51.617 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:06:54.707 +04:00 [INF] Executed DbCommand (41ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [k2].[Id], [k2].[CompletedAt], [k2].[CreatedAt], [k2].[CurrentStepNumber], [k2].[KpiGroupCompanyId], [k2].[Status], [s0].[Id], [s0].[CompletedAt], [s0].[KpiConfirmationId], [s0].[StartedAt], [s0].[Status], [s0].[StepNumber], [s0].[Id0], [s0].[ActionDate], [s0].[Comment], [s0].[IsConfirmed], [s0].[KpiConfirmationStepId], [s0].[UserId], [s0].[Id00], [s0].[CompanyId], [s0].[Email], [s0].[PasswordHash], [s0].[Username]
FROM (
    SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
    FROM [KpiConfirmations] AS [k]
    WHERE [k].[Id] = @__id_0
) AS [k2]
LEFT JOIN (
    SELECT [k0].[Id], [k0].[CompletedAt], [k0].[KpiConfirmationId], [k0].[StartedAt], [k0].[Status], [k0].[StepNumber], [s].[Id] AS [Id0], [s].[ActionDate], [s].[Comment], [s].[IsConfirmed], [s].[KpiConfirmationStepId], [s].[UserId], [s].[Id0] AS [Id00], [s].[CompanyId], [s].[Email], [s].[PasswordHash], [s].[Username]
    FROM [KpiConfirmationStep] AS [k0]
    LEFT JOIN (
        SELECT [k1].[Id], [k1].[ActionDate], [k1].[Comment], [k1].[IsConfirmed], [k1].[KpiConfirmationStepId], [k1].[UserId], [u].[Id] AS [Id0], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
        FROM [KpiConfirmationUsers] AS [k1]
        INNER JOIN [Users] AS [u] ON [k1].[UserId] = [u].[Id]
    ) AS [s] ON [k0].[Id] = [s].[KpiConfirmationStepId]
) AS [s0] ON [k2].[Id] = [s0].[KpiConfirmationId]
ORDER BY [k2].[Id], [s0].[Id], [s0].[Id0]
2025-08-14 12:12:17.363 +04:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-08-14 12:12:17.415 +04:00 [INF] Registered 32 endpoints in 1,555 milliseconds.
2025-08-14 12:12:19.162 +04:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 12:12:19.275 +04:00 [INF] Executed DbCommand (90ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-08-14 12:12:19.401 +04:00 [INF] Executed DbCommand (37ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 12:12:22.495 +04:00 [INF] Executed DbCommand (3,040ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [KPI] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-08-14 12:12:22.584 +04:00 [INF] Executed DbCommand (89ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [KPI];
2025-08-14 12:12:22.949 +04:00 [INF] Executed DbCommand (154ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [KPI];
2025-08-14 12:12:23.003 +04:00 [INF] Executed DbCommand (53ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [KPI] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-08-14 12:12:23.019 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-14 12:12:23.154 +04:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Companies] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [Address] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Companies] PRIMARY KEY ([Id])
);
2025-08-14 12:12:23.156 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [DynamicValues] (
    [Id] int NOT NULL IDENTITY,
    [Types] nvarchar(max) NOT NULL,
    [JsonValue] nvarchar(max) NOT NULL,
    [Name] nvarchar(max) NULL,
    CONSTRAINT [PK_DynamicValues] PRIMARY KEY ([Id])
);
2025-08-14 12:12:23.158 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiGroups] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_KpiGroups] PRIMARY KEY ([Id])
);
2025-08-14 12:12:23.161 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [Id] int NOT NULL IDENTITY,
    [Username] nvarchar(max) NOT NULL,
    [Email] nvarchar(max) NOT NULL,
    [PasswordHash] nvarchar(max) NOT NULL,
    [CompanyId] int NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Users_Companies_CompanyId] FOREIGN KEY ([CompanyId]) REFERENCES [Companies] ([Id]) ON DELETE CASCADE
);
2025-08-14 12:12:23.164 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Kpis] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [GriIndex] int NOT NULL,
    [TimePeriod] int NOT NULL,
    [KpiGroupId] int NOT NULL,
    [CompanyId] int NULL,
    CONSTRAINT [PK_Kpis] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Kpis_Companies_CompanyId] FOREIGN KEY ([CompanyId]) REFERENCES [Companies] ([Id]),
    CONSTRAINT [FK_Kpis_KpiGroups_KpiGroupId] FOREIGN KEY ([KpiGroupId]) REFERENCES [KpiGroups] ([Id]) ON DELETE CASCADE
);
2025-08-14 12:12:23.167 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiGroupCompanys] (
    [Id] int NOT NULL IDENTITY,
    [KpiGroupId] int NOT NULL,
    [CompanyId] int NOT NULL,
    [UserId] int NOT NULL,
    CONSTRAINT [PK_KpiGroupCompanys] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiGroupCompanys_Companies_CompanyId] FOREIGN KEY ([CompanyId]) REFERENCES [Companies] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_KpiGroupCompanys_KpiGroups_KpiGroupId] FOREIGN KEY ([KpiGroupId]) REFERENCES [KpiGroups] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_KpiGroupCompanys_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE NO ACTION
);
2025-08-14 12:12:23.170 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiConfirmations] (
    [Id] int NOT NULL IDENTITY,
    [KpiGroupCompanyId] int NOT NULL,
    [Status] int NOT NULL,
    [CurrentStepNumber] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [CompletedAt] datetime2 NULL,
    CONSTRAINT [PK_KpiConfirmations] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiConfirmations_KpiGroupCompanys_KpiGroupCompanyId] FOREIGN KEY ([KpiGroupCompanyId]) REFERENCES [KpiGroupCompanys] ([Id]) ON DELETE CASCADE
);
2025-08-14 12:12:23.173 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiConfirmationStep] (
    [Id] int NOT NULL IDENTITY,
    [KpiConfirmationId] int NOT NULL,
    [StepNumber] int NOT NULL,
    [Status] int NOT NULL,
    [StartedAt] datetime2 NULL,
    [CompletedAt] datetime2 NULL,
    CONSTRAINT [PK_KpiConfirmationStep] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiConfirmationStep_KpiConfirmations_KpiConfirmationId] FOREIGN KEY ([KpiConfirmationId]) REFERENCES [KpiConfirmations] ([Id]) ON DELETE CASCADE
);
2025-08-14 12:12:23.176 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiValues] (
    [Id] int NOT NULL IDENTITY,
    [KpiId] int NOT NULL,
    [ValueId] int NOT NULL,
    [Status] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [Comment] nvarchar(max) NOT NULL,
    [KpiConfirmationId] int NULL,
    CONSTRAINT [PK_KpiValues] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiValues_DynamicValues_ValueId] FOREIGN KEY ([ValueId]) REFERENCES [DynamicValues] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_KpiValues_KpiConfirmations_KpiConfirmationId] FOREIGN KEY ([KpiConfirmationId]) REFERENCES [KpiConfirmations] ([Id]),
    CONSTRAINT [FK_KpiValues_Kpis_KpiId] FOREIGN KEY ([KpiId]) REFERENCES [Kpis] ([Id]) ON DELETE CASCADE
);
2025-08-14 12:12:23.182 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [KpiConfirmationUsers] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [IsConfirmed] bit NULL,
    [Comment] nvarchar(max) NOT NULL,
    [ActionDate] datetime2 NULL,
    [KpiConfirmationStepId] int NULL,
    CONSTRAINT [PK_KpiConfirmationUsers] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KpiConfirmationUsers_KpiConfirmationStep_KpiConfirmationStepId] FOREIGN KEY ([KpiConfirmationStepId]) REFERENCES [KpiConfirmationStep] ([Id]),
    CONSTRAINT [FK_KpiConfirmationUsers_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE NO ACTION
);
2025-08-14 12:12:23.184 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmations_KpiGroupCompanyId] ON [KpiConfirmations] ([KpiGroupCompanyId]);
2025-08-14 12:12:23.186 +04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmationStep_KpiConfirmationId] ON [KpiConfirmationStep] ([KpiConfirmationId]);
2025-08-14 12:12:23.188 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmationUsers_KpiConfirmationStepId] ON [KpiConfirmationUsers] ([KpiConfirmationStepId]);
2025-08-14 12:12:23.189 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiConfirmationUsers_UserId] ON [KpiConfirmationUsers] ([UserId]);
2025-08-14 12:12:23.190 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiGroupCompanys_CompanyId] ON [KpiGroupCompanys] ([CompanyId]);
2025-08-14 12:12:23.191 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiGroupCompanys_KpiGroupId] ON [KpiGroupCompanys] ([KpiGroupId]);
2025-08-14 12:12:23.192 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiGroupCompanys_UserId] ON [KpiGroupCompanys] ([UserId]);
2025-08-14 12:12:23.194 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Kpis_CompanyId] ON [Kpis] ([CompanyId]);
2025-08-14 12:12:23.195 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Kpis_KpiGroupId] ON [Kpis] ([KpiGroupId]);
2025-08-14 12:12:23.196 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiValues_KpiConfirmationId] ON [KpiValues] ([KpiConfirmationId]);
2025-08-14 12:12:23.197 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiValues_KpiId] ON [KpiValues] ([KpiId]);
2025-08-14 12:12:23.198 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_KpiValues_ValueId] ON [KpiValues] ([ValueId]);
2025-08-14 12:12:23.199 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Users_CompanyId] ON [Users] ([CompanyId]);
2025-08-14 12:12:23.275 +04:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-08-14 12:12:23.300 +04:00 [INF] User profile is available. Using 'C:\Users\zakir\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-14 12:12:23.626 +04:00 [INF] Now listening on: https://localhost:57679
2025-08-14 12:12:23.626 +04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-14 12:12:23.626 +04:00 [INF] Hosting environment: Development
2025-08-14 12:12:23.627 +04:00 [INF] Content root path: E:\Work\KPI\KpiScope\src\KpiScope.Web
2025-08-14 12:12:26.817 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - null null
2025-08-14 12:12:26.915 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:12:30.269 +04:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-08-14 12:12:30.444 +04:00 [INF] Executed DbCommand (62ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [k2].[Id], [k2].[CompletedAt], [k2].[CreatedAt], [k2].[CurrentStepNumber], [k2].[KpiGroupCompanyId], [k2].[Status], [s0].[Id], [s0].[CompletedAt], [s0].[KpiConfirmationId], [s0].[StartedAt], [s0].[Status], [s0].[StepNumber], [s0].[Id0], [s0].[ActionDate], [s0].[Comment], [s0].[IsConfirmed], [s0].[KpiConfirmationStepId], [s0].[UserId], [s0].[Id00], [s0].[CompanyId], [s0].[Email], [s0].[PasswordHash], [s0].[Username]
FROM (
    SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
    FROM [KpiConfirmations] AS [k]
    WHERE [k].[Id] = @__id_0
) AS [k2]
LEFT JOIN (
    SELECT [k0].[Id], [k0].[CompletedAt], [k0].[KpiConfirmationId], [k0].[StartedAt], [k0].[Status], [k0].[StepNumber], [s].[Id] AS [Id0], [s].[ActionDate], [s].[Comment], [s].[IsConfirmed], [s].[KpiConfirmationStepId], [s].[UserId], [s].[Id0] AS [Id00], [s].[CompanyId], [s].[Email], [s].[PasswordHash], [s].[Username]
    FROM [KpiConfirmationStep] AS [k0]
    LEFT JOIN (
        SELECT [k1].[Id], [k1].[ActionDate], [k1].[Comment], [k1].[IsConfirmed], [k1].[KpiConfirmationStepId], [k1].[UserId], [u].[Id] AS [Id0], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
        FROM [KpiConfirmationUsers] AS [k1]
        INNER JOIN [Users] AS [u] ON [k1].[UserId] = [u].[Id]
    ) AS [s] ON [k0].[Id] = [s].[KpiConfirmationStepId]
) AS [s0] ON [k2].[Id] = [s0].[KpiConfirmationId]
ORDER BY [k2].[Id], [s0].[Id], [s0].[Id0]
2025-08-14 12:12:30.606 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:12:30.609 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: KPI Confirmation 1 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.GetConfirmationStepAsync(Int32 id) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 51
   at KpiScope.Web.KpiConfirmation.GetConfirmationStepsById.GetStepById.HandleAsync(CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\GetConfirmationStepsById\GetStepById.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 12:12:30.749 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/1/steps   Responded with [500] in 3828ms
2025-08-14 12:12:30.758 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - 500 165 application/json 3942.5891ms
2025-08-14 12:12:35.648 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - null null
2025-08-14 12:12:35.651 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:12:46.381 +04:00 [INF] Executed DbCommand (23ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [k2].[Id], [k2].[CompletedAt], [k2].[CreatedAt], [k2].[CurrentStepNumber], [k2].[KpiGroupCompanyId], [k2].[Status], [s0].[Id], [s0].[CompletedAt], [s0].[KpiConfirmationId], [s0].[StartedAt], [s0].[Status], [s0].[StepNumber], [s0].[Id0], [s0].[ActionDate], [s0].[Comment], [s0].[IsConfirmed], [s0].[KpiConfirmationStepId], [s0].[UserId], [s0].[Id00], [s0].[CompanyId], [s0].[Email], [s0].[PasswordHash], [s0].[Username]
FROM (
    SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
    FROM [KpiConfirmations] AS [k]
    WHERE [k].[Id] = @__id_0
) AS [k2]
LEFT JOIN (
    SELECT [k0].[Id], [k0].[CompletedAt], [k0].[KpiConfirmationId], [k0].[StartedAt], [k0].[Status], [k0].[StepNumber], [s].[Id] AS [Id0], [s].[ActionDate], [s].[Comment], [s].[IsConfirmed], [s].[KpiConfirmationStepId], [s].[UserId], [s].[Id0] AS [Id00], [s].[CompanyId], [s].[Email], [s].[PasswordHash], [s].[Username]
    FROM [KpiConfirmationStep] AS [k0]
    LEFT JOIN (
        SELECT [k1].[Id], [k1].[ActionDate], [k1].[Comment], [k1].[IsConfirmed], [k1].[KpiConfirmationStepId], [k1].[UserId], [u].[Id] AS [Id0], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
        FROM [KpiConfirmationUsers] AS [k1]
        INNER JOIN [Users] AS [u] ON [k1].[UserId] = [u].[Id]
    ) AS [s] ON [k0].[Id] = [s].[KpiConfirmationStepId]
) AS [s0] ON [k2].[Id] = [s0].[KpiConfirmationId]
ORDER BY [k2].[Id], [s0].[Id], [s0].[Id0]
2025-08-14 12:12:49.073 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:12:49.073 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: KPI Confirmation 1 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.GetConfirmationStepAsync(Int32 id) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 51
   at KpiScope.Web.KpiConfirmation.GetConfirmationStepsById.GetStepById.HandleAsync(CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\GetConfirmationStepsById\GetStepById.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 12:12:49.075 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/1/steps   Responded with [500] in 13423ms
2025-08-14 12:12:49.076 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - 500 165 application/json 13427.4151ms
2025-08-14 12:13:00.264 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - null null
2025-08-14 12:13:00.265 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:13:02.483 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [k2].[Id], [k2].[CompletedAt], [k2].[CreatedAt], [k2].[CurrentStepNumber], [k2].[KpiGroupCompanyId], [k2].[Status], [s0].[Id], [s0].[CompletedAt], [s0].[KpiConfirmationId], [s0].[StartedAt], [s0].[Status], [s0].[StepNumber], [s0].[Id0], [s0].[ActionDate], [s0].[Comment], [s0].[IsConfirmed], [s0].[KpiConfirmationStepId], [s0].[UserId], [s0].[Id00], [s0].[CompanyId], [s0].[Email], [s0].[PasswordHash], [s0].[Username]
FROM (
    SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
    FROM [KpiConfirmations] AS [k]
    WHERE [k].[Id] = @__id_0
) AS [k2]
LEFT JOIN (
    SELECT [k0].[Id], [k0].[CompletedAt], [k0].[KpiConfirmationId], [k0].[StartedAt], [k0].[Status], [k0].[StepNumber], [s].[Id] AS [Id0], [s].[ActionDate], [s].[Comment], [s].[IsConfirmed], [s].[KpiConfirmationStepId], [s].[UserId], [s].[Id0] AS [Id00], [s].[CompanyId], [s].[Email], [s].[PasswordHash], [s].[Username]
    FROM [KpiConfirmationStep] AS [k0]
    LEFT JOIN (
        SELECT [k1].[Id], [k1].[ActionDate], [k1].[Comment], [k1].[IsConfirmed], [k1].[KpiConfirmationStepId], [k1].[UserId], [u].[Id] AS [Id0], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
        FROM [KpiConfirmationUsers] AS [k1]
        INNER JOIN [Users] AS [u] ON [k1].[UserId] = [u].[Id]
    ) AS [s] ON [k0].[Id] = [s].[KpiConfirmationStepId]
) AS [s0] ON [k2].[Id] = [s0].[KpiConfirmationId]
ORDER BY [k2].[Id], [s0].[Id], [s0].[Id0]
2025-08-14 12:14:13.342 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:14:13.476 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: KPI Confirmation 1 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.GetConfirmationStepAsync(Int32 id) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 51
   at KpiScope.Web.KpiConfirmation.GetConfirmationStepsById.GetStepById.HandleAsync(CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\GetConfirmationStepsById\GetStepById.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 12:14:13.489 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Companies - application/json 45
2025-08-14 12:14:13.490 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/1/steps   Responded with [500] in 73225ms
2025-08-14 12:14:13.491 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - 500 165 application/json 73226.5333ms
2025-08-14 12:14:13.502 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/auth/Register - application/json 100
2025-08-14 12:14:13.505 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/auth/Register - application/json 100
2025-08-14 12:14:13.505 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Companies - application/json 45
2025-08-14 12:14:13.505 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - null null
2025-08-14 12:14:13.506 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:14:25.843 +04:00 [INF] Executing endpoint 'HTTP: POST /Companies'
2025-08-14 12:14:25.843 +04:00 [INF] Executing endpoint 'HTTP: POST auth/Register'
2025-08-14 12:14:25.919 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Companies - 499 null null 12429.8698ms
2025-08-14 12:14:25.919 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/auth/Register - 499 null null 12417.1994ms
2025-08-14 12:14:25.933 +04:00 [INF] Executed DbCommand (29ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [k2].[Id], [k2].[CompletedAt], [k2].[CreatedAt], [k2].[CurrentStepNumber], [k2].[KpiGroupCompanyId], [k2].[Status], [s0].[Id], [s0].[CompletedAt], [s0].[KpiConfirmationId], [s0].[StartedAt], [s0].[Status], [s0].[StepNumber], [s0].[Id0], [s0].[ActionDate], [s0].[Comment], [s0].[IsConfirmed], [s0].[KpiConfirmationStepId], [s0].[UserId], [s0].[Id00], [s0].[CompanyId], [s0].[Email], [s0].[PasswordHash], [s0].[Username]
FROM (
    SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
    FROM [KpiConfirmations] AS [k]
    WHERE [k].[Id] = @__id_0
) AS [k2]
LEFT JOIN (
    SELECT [k0].[Id], [k0].[CompletedAt], [k0].[KpiConfirmationId], [k0].[StartedAt], [k0].[Status], [k0].[StepNumber], [s].[Id] AS [Id0], [s].[ActionDate], [s].[Comment], [s].[IsConfirmed], [s].[KpiConfirmationStepId], [s].[UserId], [s].[Id0] AS [Id00], [s].[CompanyId], [s].[Email], [s].[PasswordHash], [s].[Username]
    FROM [KpiConfirmationStep] AS [k0]
    LEFT JOIN (
        SELECT [k1].[Id], [k1].[ActionDate], [k1].[Comment], [k1].[IsConfirmed], [k1].[KpiConfirmationStepId], [k1].[UserId], [u].[Id] AS [Id0], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
        FROM [KpiConfirmationUsers] AS [k1]
        INNER JOIN [Users] AS [u] ON [k1].[UserId] = [u].[Id]
    ) AS [s] ON [k0].[Id] = [s].[KpiConfirmationStepId]
) AS [s0] ON [k2].[Id] = [s0].[KpiConfirmationId]
ORDER BY [k2].[Id], [s0].[Id], [s0].[Id0]
2025-08-14 12:14:26.081 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:14:26.081 +04:00 [ERR] [500]: Unhandled Exception occurred. Unable to process the request.
System.Collections.Generic.KeyNotFoundException: KPI Confirmation 1 not found
   at KpiScope.Web.KpiConfirmation.KpiConfirmationEndpointService.GetConfirmationStepAsync(Int32 id) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\KpiConfirmationEndpointService.cs:line 51
   at KpiScope.Web.KpiConfirmation.GetConfirmationStepsById.GetStepById.HandleAsync(CancellationToken cancellationToken) in E:\Work\KPI\KpiScope\src\KpiScope.Web\KpiConfirmation\GetConfirmationStepsById\GetStepById.cs:line 14
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at AutoWrapper.Base.WrapperBase.InvokeAsyncBase(HttpContext context, AutoWrapperMembers awm)
2025-08-14 12:14:26.083 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/1/steps   Responded with [500] in 12576ms
2025-08-14 12:14:26.083 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - 500 165 application/json 12577.8903ms
2025-08-14 12:14:26.145 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@__mail_0='?' (Size = 4000), @__username_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Email] = @__mail_0 OR [u].[Username] = @__username_1
2025-08-14 12:14:26.265 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Companies] ([Address], [Name])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1);
2025-08-14 12:14:26.279 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CompanyId], [Email], [PasswordHash], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2025-08-14 12:14:26.308 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p4='?' (DbType = Int32), @p0='?' (DbType = Int32), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Users] SET [CompanyId] = @p0, [Email] = @p1, [PasswordHash] = @p2, [Username] = @p3
OUTPUT 1
WHERE [Id] = @p4;
2025-08-14 12:14:26.314 +04:00 [INF] Executed endpoint 'HTTP: POST /Companies'
2025-08-14 12:14:26.314 +04:00 [INF] Executed endpoint 'HTTP: POST auth/Register'
2025-08-14 12:14:26.364 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/auth/Register  {
  "username": "string",
  "password": "string",
  "email": "user@example.com",
  "comapanyId": 1
} Responded with [200] in 12855ms
2025-08-14 12:14:26.364 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Companies  {
  "name": "string",
  "address": "string"
} Responded with [200] in 12857ms
2025-08-14 12:14:26.364 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/auth/Register - 200 162 application/json 12858.785ms
2025-08-14 12:14:26.364 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Companies - 200 150 application/json 12858.785ms
2025-08-14 12:14:40.173 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/KpiGroups - application/json 30
2025-08-14 12:14:40.174 +04:00 [INF] Executing endpoint 'HTTP: POST /KpiGroups'
2025-08-14 12:14:40.211 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiGroups] ([Name])
OUTPUT INSERTED.[Id]
VALUES (@p0);
2025-08-14 12:14:40.215 +04:00 [INF] Executed endpoint 'HTTP: POST /KpiGroups'
2025-08-14 12:14:40.217 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/KpiGroups  {
  "name": "KPI Group Name"
} Responded with [200] in 42ms
2025-08-14 12:14:40.217 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/KpiGroups - 200 132 application/json 44.0124ms
2025-08-14 12:14:47.511 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/KpiGroupCompanies - application/json 54
2025-08-14 12:14:47.511 +04:00 [INF] Executing endpoint 'HTTP: POST /KpiGroupCompanies'
2025-08-14 12:14:47.575 +04:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiGroupCompanys] ([CompanyId], [KpiGroupId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 12:14:47.580 +04:00 [INF] Executed endpoint 'HTTP: POST /KpiGroupCompanies'
2025-08-14 12:14:47.580 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/KpiGroupCompanies  {
  "kpiGroupId": 1,
  "companyId": 1,
  "userId": 1
} Responded with [200] in 68ms
2025-08-14 12:14:47.580 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/KpiGroupCompanies - 200 162 application/json 69.2443ms
2025-08-14 12:14:58.052 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi - application/json 77
2025-08-14 12:14:58.052 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi'
2025-08-14 12:14:58.111 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Kpis] ([CompanyId], [GriIndex], [KpiGroupId], [Name], [TimePeriod])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 12:14:58.121 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi'
2025-08-14 12:14:58.122 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi  {
  "name": "string",
  "griIndex": 1,
  "timePeriod": 1,
  "kpiGroupId": 1
} Responded with [200] in 69ms
2025-08-14 12:14:58.122 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi - 200 188 application/json 70.1778ms
2025-08-14 12:15:07.114 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi/AddValue - application/json 288
2025-08-14 12:15:07.115 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:15:07.209 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [DynamicValues] ([JsonValue], [Name], [Types])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 12:15:07.252 +04:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiValues] ([Comment], [CreatedAt], [KpiConfirmationId], [KpiId], [Status], [ValueId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-14 12:15:07.262 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:15:07.265 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi/AddValue  {
  "kpiValue": {
    "kpiId": 1,
    "dynamicValue": {
      "layers": [
        {
          "type": 1,
          "value": "['slalm','sagol']"
        }
      ],
      "name": "string"
    },
    "statusEnum": 1,
    "createdAt": "2025-08-14T07:59:58.424Z",
    "comment": "string"
  }
} Responded with [200] in 149ms
2025-08-14 12:15:07.265 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi/AddValue - 200 276 application/json 151.0316ms
2025-08-14 12:15:16.090 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi/AddValue - application/json 277
2025-08-14 12:15:16.090 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:15:16.095 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [DynamicValues] ([JsonValue], [Name], [Types])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 12:15:16.100 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiValues] ([Comment], [CreatedAt], [KpiConfirmationId], [KpiId], [Status], [ValueId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-14 12:15:16.101 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:15:16.102 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi/AddValue  {
  "kpiValue": {
    "kpiId": 1,
    "dynamicValue": {
      "layers": [
        {
          "type": 1,
          "value": "string"
        }
      ],
      "name": "string"
    },
    "statusEnum": 1,
    "createdAt": "2025-08-14T07:59:58.424Z",
    "comment": "string"
  }
} Responded with [200] in 11ms
2025-08-14 12:15:16.102 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi/AddValue - 200 276 application/json 12.4985ms
2025-08-14 12:15:25.664 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations - application/json 116
2025-08-14 12:15:25.665 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 12:15:25.712 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmations] ([CompletedAt], [CreatedAt], [CurrentStepNumber], [KpiGroupCompanyId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 12:15:25.724 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 12:15:25.729 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations  {
  "kpiGroupCompanyId": 1,
  "periodStart": "2025-08-14T08:00:53.868Z",
  "periodEnd": "2025-08-14T08:00:53.868Z"
} Responded with [200] in 64ms
2025-08-14 12:15:25.729 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations - 200 169 application/json 65.2511ms
2025-08-14 12:15:35.219 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/1/confirm - application/json 91
2025-08-14 12:15:35.220 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 12:15:38.577 +04:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmationUsers] ([ActionDate], [Comment], [IsConfirmed], [KpiConfirmationStepId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 12:15:38.615 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
FROM [KpiConfirmations] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 12:15:38.666 +04:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p6='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [KpiConfirmationStep] ([CompletedAt], [KpiConfirmationId], [StartedAt], [Status], [StepNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [KpiConfirmations] SET [CurrentStepNumber] = @p5
OUTPUT 1
WHERE [Id] = @p6;
2025-08-14 12:15:38.675 +04:00 [INF] Executed DbCommand (6ms) [Parameters=[@p8='?' (DbType = Int32), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [KpiConfirmationUsers] SET [KpiConfirmationStepId] = @p7
OUTPUT 1
WHERE [Id] = @p8;
2025-08-14 12:15:38.687 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 12:15:38.688 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations/1/confirm  {
  "stepUserId": 1,
  "kpiGroupCompanyId": 1,
  "confirmationId": 1,
  "comment": "good"
} Responded with [200] in 3468ms
2025-08-14 12:15:38.688 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/1/confirm - 200 131 application/json 3469.0662ms
2025-08-14 12:15:46.198 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - null null
2025-08-14 12:15:46.199 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:15:50.402 +04:00 [INF] Executed DbCommand (22ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [k2].[Id], [k2].[CompletedAt], [k2].[CreatedAt], [k2].[CurrentStepNumber], [k2].[KpiGroupCompanyId], [k2].[Status], [s0].[Id], [s0].[CompletedAt], [s0].[KpiConfirmationId], [s0].[StartedAt], [s0].[Status], [s0].[StepNumber], [s0].[Id0], [s0].[ActionDate], [s0].[Comment], [s0].[IsConfirmed], [s0].[KpiConfirmationStepId], [s0].[UserId], [s0].[Id00], [s0].[CompanyId], [s0].[Email], [s0].[PasswordHash], [s0].[Username]
FROM (
    SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
    FROM [KpiConfirmations] AS [k]
    WHERE [k].[Id] = @__id_0
) AS [k2]
LEFT JOIN (
    SELECT [k0].[Id], [k0].[CompletedAt], [k0].[KpiConfirmationId], [k0].[StartedAt], [k0].[Status], [k0].[StepNumber], [s].[Id] AS [Id0], [s].[ActionDate], [s].[Comment], [s].[IsConfirmed], [s].[KpiConfirmationStepId], [s].[UserId], [s].[Id0] AS [Id00], [s].[CompanyId], [s].[Email], [s].[PasswordHash], [s].[Username]
    FROM [KpiConfirmationStep] AS [k0]
    LEFT JOIN (
        SELECT [k1].[Id], [k1].[ActionDate], [k1].[Comment], [k1].[IsConfirmed], [k1].[KpiConfirmationStepId], [k1].[UserId], [u].[Id] AS [Id0], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
        FROM [KpiConfirmationUsers] AS [k1]
        INNER JOIN [Users] AS [u] ON [k1].[UserId] = [u].[Id]
    ) AS [s] ON [k0].[Id] = [s].[KpiConfirmationStepId]
) AS [s0] ON [k2].[Id] = [s0].[KpiConfirmationId]
ORDER BY [k2].[Id], [s0].[Id], [s0].[Id0]
2025-08-14 12:15:59.575 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:15:59.576 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/1/steps   Responded with [200] in 13377ms
2025-08-14 12:15:59.577 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - 200 319 application/json 13378.5915ms
2025-08-14 12:16:17.942 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/1/reject - application/json 93
2025-08-14 12:16:17.942 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/reject'
2025-08-14 12:16:21.945 +04:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmationUsers] ([ActionDate], [Comment], [IsConfirmed], [KpiConfirmationStepId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 12:16:21.948 +04:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
FROM [KpiConfirmations] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 12:16:21.955 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p6='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [KpiConfirmationStep] ([CompletedAt], [KpiConfirmationId], [StartedAt], [Status], [StepNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [KpiConfirmations] SET [CurrentStepNumber] = @p5
OUTPUT 1
WHERE [Id] = @p6;
2025-08-14 12:16:21.960 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p8='?' (DbType = Int32), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [KpiConfirmationUsers] SET [KpiConfirmationStepId] = @p7
OUTPUT 1
WHERE [Id] = @p8;
2025-08-14 12:16:21.962 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/reject'
2025-08-14 12:16:21.962 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations/1/reject  {
  "stepUserId": 1,
  "kpiGroupCompanyId": 1,
  "confirmationId": 1,
  "comment": "string"
} Responded with [200] in 4020ms
2025-08-14 12:16:21.962 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/1/reject - 200 156 application/json 4020.9398ms
2025-08-14 12:16:25.891 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - null null
2025-08-14 12:16:25.891 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:16:29.467 +04:00 [INF] Executed DbCommand (16ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [k2].[Id], [k2].[CompletedAt], [k2].[CreatedAt], [k2].[CurrentStepNumber], [k2].[KpiGroupCompanyId], [k2].[Status], [s0].[Id], [s0].[CompletedAt], [s0].[KpiConfirmationId], [s0].[StartedAt], [s0].[Status], [s0].[StepNumber], [s0].[Id0], [s0].[ActionDate], [s0].[Comment], [s0].[IsConfirmed], [s0].[KpiConfirmationStepId], [s0].[UserId], [s0].[Id00], [s0].[CompanyId], [s0].[Email], [s0].[PasswordHash], [s0].[Username]
FROM (
    SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
    FROM [KpiConfirmations] AS [k]
    WHERE [k].[Id] = @__id_0
) AS [k2]
LEFT JOIN (
    SELECT [k0].[Id], [k0].[CompletedAt], [k0].[KpiConfirmationId], [k0].[StartedAt], [k0].[Status], [k0].[StepNumber], [s].[Id] AS [Id0], [s].[ActionDate], [s].[Comment], [s].[IsConfirmed], [s].[KpiConfirmationStepId], [s].[UserId], [s].[Id0] AS [Id00], [s].[CompanyId], [s].[Email], [s].[PasswordHash], [s].[Username]
    FROM [KpiConfirmationStep] AS [k0]
    LEFT JOIN (
        SELECT [k1].[Id], [k1].[ActionDate], [k1].[Comment], [k1].[IsConfirmed], [k1].[KpiConfirmationStepId], [k1].[UserId], [u].[Id] AS [Id0], [u].[CompanyId], [u].[Email], [u].[PasswordHash], [u].[Username]
        FROM [KpiConfirmationUsers] AS [k1]
        INNER JOIN [Users] AS [u] ON [k1].[UserId] = [u].[Id]
    ) AS [s] ON [k0].[Id] = [s].[KpiConfirmationStepId]
) AS [s0] ON [k2].[Id] = [s0].[KpiConfirmationId]
ORDER BY [k2].[Id], [s0].[Id], [s0].[Id0]
2025-08-14 12:16:29.469 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
2025-08-14 12:16:29.470 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/1/steps   Responded with [200] in 3578ms
2025-08-14 12:16:29.471 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - 200 505 application/json 3579.8848ms
2025-08-14 12:22:11.305 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1 - null null
2025-08-14 12:22:11.336 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}'
2025-08-14 12:22:11.357 +04:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
FROM [KpiConfirmations] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 12:22:11.367 +04:00 [INF] Executed endpoint 'HTTP: GET /kpiConfirmations/{id}'
2025-08-14 12:22:11.368 +04:00 [INF] Source:[::1] Request: GET https localhost:57679/kpiConfirmations/1   Responded with [200] in 32ms
2025-08-14 12:22:11.368 +04:00 [INF] Request finished HTTP/2 GET https://localhost:57679/kpiConfirmations/1 - 200 292 application/json 63.2301ms
2025-08-14 12:27:01.286 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/KpiGroupCompanies - application/json 54
2025-08-14 12:27:01.345 +04:00 [INF] Executing endpoint 'HTTP: POST /KpiGroupCompanies'
2025-08-14 12:27:01.530 +04:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiGroupCompanys] ([CompanyId], [KpiGroupId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 12:27:01.534 +04:00 [INF] Executed endpoint 'HTTP: POST /KpiGroupCompanies'
2025-08-14 12:27:01.549 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/KpiGroupCompanies  {
  "kpiGroupId": 1,
  "companyId": 1,
  "userId": 1
} Responded with [200] in 216ms
2025-08-14 12:27:01.550 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/KpiGroupCompanies - 200 162 application/json 268.0131ms
2025-08-14 12:27:19.102 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi - application/json 75
2025-08-14 12:27:19.104 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi'
2025-08-14 12:27:19.132 +04:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Kpis] ([CompanyId], [GriIndex], [KpiGroupId], [Name], [TimePeriod])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 12:27:19.135 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi'
2025-08-14 12:27:19.136 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi  {
  "name": "test",
  "griIndex": 1,
  "timePeriod": 1,
  "kpiGroupId": 1
} Responded with [200] in 32ms
2025-08-14 12:27:19.137 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi - 200 186 application/json 34.5548ms
2025-08-14 12:27:24.373 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi/AddValue - application/json 277
2025-08-14 12:27:24.373 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:27:24.393 +04:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [DynamicValues] ([JsonValue], [Name], [Types])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 12:27:24.410 +04:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiValues] ([Comment], [CreatedAt], [KpiConfirmationId], [KpiId], [Status], [ValueId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-14 12:27:24.413 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:27:24.414 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi/AddValue  {
  "kpiValue": {
    "kpiId": 1,
    "dynamicValue": {
      "layers": [
        {
          "type": 1,
          "value": "string"
        }
      ],
      "name": "string"
    },
    "statusEnum": 1,
    "createdAt": "2025-08-14T07:59:58.424Z",
    "comment": "string"
  }
} Responded with [200] in 40ms
2025-08-14 12:27:24.414 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi/AddValue - 200 276 application/json 41.7936ms
2025-08-14 12:27:36.498 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/Kpi/AddValue - application/json 276
2025-08-14 12:27:36.500 +04:00 [INF] Executing endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:27:36.513 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [DynamicValues] ([JsonValue], [Name], [Types])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-08-14 12:27:36.520 +04:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiValues] ([Comment], [CreatedAt], [KpiConfirmationId], [KpiId], [Status], [ValueId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-14 12:27:36.522 +04:00 [INF] Executed endpoint 'HTTP: POST /Kpi/AddValue'
2025-08-14 12:27:36.523 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/Kpi/AddValue  {
  "kpiValue": {
    "kpiId": 1,
    "dynamicValue": {
      "layers": [
        {
          "type": 1,
          "value": "wecwq"
        }
      ],
      "name": "string"
    },
    "statusEnum": 1,
    "createdAt": "2025-08-14T07:59:58.424Z",
    "comment": "string"
  }
} Responded with [200] in 23ms
2025-08-14 12:27:36.524 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/Kpi/AddValue - 200 276 application/json 25.0602ms
2025-08-14 12:29:21.590 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations - application/json 116
2025-08-14 12:29:21.660 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 12:29:21.681 +04:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmations] ([CompletedAt], [CreatedAt], [CurrentStepNumber], [KpiGroupCompanyId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 12:29:21.684 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations'
2025-08-14 12:29:21.686 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations  {
  "kpiGroupCompanyId": 2,
  "periodStart": "2025-08-14T08:00:53.868Z",
  "periodEnd": "2025-08-14T08:00:53.868Z"
} Responded with [200] in 26ms
2025-08-14 12:29:21.687 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations - 200 169 application/json 96.4388ms
2025-08-14 12:29:42.116 +04:00 [INF] Request starting HTTP/2 POST https://localhost:57679/kpiConfirmations/2/confirm - application/json 91
2025-08-14 12:29:42.178 +04:00 [INF] Executing endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 12:29:46.513 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [KpiConfirmationUsers] ([ActionDate], [Comment], [IsConfirmed], [KpiConfirmationStepId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-08-14 12:29:46.523 +04:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [k].[Id], [k].[CompletedAt], [k].[CreatedAt], [k].[CurrentStepNumber], [k].[KpiGroupCompanyId], [k].[Status]
FROM [KpiConfirmations] AS [k]
WHERE [k].[Id] = @__p_0
2025-08-14 12:29:46.538 +04:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p6='?' (DbType = Int32), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [KpiConfirmationStep] ([CompletedAt], [KpiConfirmationId], [StartedAt], [Status], [StepNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [KpiConfirmations] SET [CurrentStepNumber] = @p5
OUTPUT 1
WHERE [Id] = @p6;
2025-08-14 12:29:46.545 +04:00 [INF] Executed DbCommand (6ms) [Parameters=[@p8='?' (DbType = Int32), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [KpiConfirmationUsers] SET [KpiConfirmationStepId] = @p7
OUTPUT 1
WHERE [Id] = @p8;
2025-08-14 12:29:46.547 +04:00 [INF] Executed endpoint 'HTTP: POST /kpiConfirmations/{id}/confirm'
2025-08-14 12:29:46.547 +04:00 [INF] Source:[::1] Request: POST https localhost:57679/kpiConfirmations/2/confirm  {
  "stepUserId": 1,
  "kpiGroupCompanyId": 1,
  "confirmationId": 2,
  "comment": "good"
} Responded with [200] in 4369ms
2025-08-14 12:29:46.548 +04:00 [INF] Request finished HTTP/2 POST https://localhost:57679/kpiConfirmations/2/confirm - 200 131 application/json 4431.3506ms
2025-08-14 12:29:56.364 +04:00 [INF] Request starting HTTP/2 GET https://localhost:57679/kpiConfirmations/1/steps - null null
2025-08-14 12:29:56.365 +04:00 [INF] Executing endpoint 'HTTP: GET /kpiConfirmations/{id}/steps'
